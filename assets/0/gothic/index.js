"use strict";(()=>{function T({q:e,eg:t,ge:n}){let o=document.querySelector("form.input");o.querySelector('[name="q"]').value=e,o.querySelector('[name="eg"]').checked=t,o.querySelector('[name="ge"]').checked=n}var M=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"]];function c(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function v(e){let t=String(e);if(!e)return"";for(let[n,o]of M)t=t.replace(new RegExp(c(n),"g"),o);return t}var A=M.reverse();var y="https://raw.githubusercontent.com/axtk/gothic/refs/heads/main",d={abbrs:`${y}/abbreviations.processed.json`,ge:`${y}/gothic-english.processed.json`,eg:`${y}/english-gothic.processed.json`};async function S(e){let[t,n,o]=await Promise.all([e.data.abbrs?null:d.abbrs,e.data.ge||!e.ge?null:d.ge,e.data.eg||!e.eg?null:d.eg].map(r=>r&&fetch(r).then(i=>i.json())));t&&(e.data.abbrs=t),n&&(e.data.ge=n),o&&(e.data.eg=o)}var L={"\u{10330}":"a","\u{10331}":"b","\u{10332}":"g","\u{10333}":"d","\u{10334}":"e","\u{10335}":"q","\u{10336}":"z","\u{10337}":"h","\u{10338}":"\xFE","\u{10339}":"i","\u{1033A}":"k","\u{1033B}":"l","\u{1033C}":"m","\u{1033D}":"n","\u{1033E}":"j","\u{1033F}":"u","\u{10340}":"p","\u{10342}":"r","\u{10343}":"s","\u{10344}":"t","\u{10345}":"w","\u{10346}":"f","\u{10347}":"x","\u{10348}":"\u0195","\u{10349}":"\u014D"};function E(e){let t=e;for(let[n,o]of Object.entries(L))t.includes(n)&&(t=t.replace(new RegExp(c(n),"g"),o));return t}function I(e,{data:{abbrs:t}}){if(!t||!(e in t))return`<abbr>${e}</abbr>`;let{d:n,t:o,g:r,s:i}=t[e],l=o??e,s=r?` data-group="${r}"`:"";switch(i){case"i":return`<i>${l}</i>`;case"regular":return l;default:return`<abbr title="${n}"${s}>${l}</abbr>`}}function q(e,t,n){let o=e.term,r=e.def;if(o=o.replace(/\{\{(&\w+)\}\}/g,"$1;"),r=r.replace(/\{\{(&\w+)\}\}/g,"$1;"),n.data.abbrs){let u=Object.keys(n.data.abbrs);for(let f of u){let g=new RegExp(c(`{{${f}}}`),"g"),p=I(f,n);o=o.replace(g,p),r=r.replace(g,p)}}r=r.replace(/(<deriv>)/g,'$1<strong class="title">Derivations:</strong> '),r=r.replace(/(<comp>)/g,'$1<strong class="title">Compounds:</strong> '),r=r.replace(/<(note|def|ex(-t|-sep)?|term|d|intro|deriv|comp)>/g,'<span class="$1">'),r=r.replace(/<\/(note|def|ex(-t|-sep)?|term|d|intro|deriv|comp)>/g,"</span>"),r=r.replace(/<(ex-s|spec|v)>/g,'<i class="$1">'),r=r.replace(/<\/(ex-s|spec|v)>/g,"</i>");let{value:i,captureIndex:l}=t.expressions[e.expressionIndex],s,a;return l>1?(s=new RegExp(i,"gi"),a=`$${l-1}<mark>$${l}</mark>$${l+1}`):(s=new RegExp(`(${i})`,"gi"),a="<mark>$1</mark>"),o=o.replace(s,a),r=r.replace(s,a),o=o.replace(/&<\/mark>(#?\w+;)/g,"&$1</mark>"),r=r.replace(/&<\/mark>(#?\w+;)/g,"&$1</mark>"),e.htmlTerm=o,e.htmlDef=r,e}function w(e){return e?e.toLowerCase().replace(/\s+/g," ").trim().replace(/þ/gi,"th").replace(/á/gi,"a").replace(/é/gi,"e").replace(/í/gi,"i").replace(/ó/gi,"o").replace(/ú/gi,"u"):""}function D({relevance:e=0},{relevance:t=0}){return e===t?0:e>t?-1:1}async function H(e){let t=w(E(e.q));if(!t)return;await S(e);let n={expressions:[{value:`\\b${c(t)}\\b`,captureIndex:1},{value:c(t),captureIndex:1}],entries:[]};t.length<4&&(n.expressions=[{value:`(^|\\pP|\\b)(${c(t)})(\\pP|\\b|$)`,captureIndex:2}]);let{expressions:o}=n,r=o.length,i={eg:e.data.eg,ge:e.data.ge};for(let[l,s]of Object.entries(i))if(s)for(let a of s){let u=w(a.t),f=w(a.d),g=!1;for(let p=0;p<r&&!g;p++){let{value:$}=o[p],C=new RegExp($,"g").test(u),R=new RegExp($,"g");if(g=C||R.test(f),!g)continue;let m={dictionaryKey:l,expressionIndex:p,term:a.t,def:a.dx},h=20*(r-p-1);if(C)if(u===t)m.relevance=h+20;else{let x=t.length,b=u.length;m.relevance=h+10+10*(x<b?x/b:b/x)}else f.length!==0&&(m.relevance=h+10*(1-R.lastIndex/f.length));n.entries.push(q(m,n,e))}}return n.entries.sort(D),n}async function k(e){let{q:t}=e,n=document.title.split("/").at(-1)?.trim()??"",o=document.querySelector(".output"),r=document.querySelector("h1");if(o.toggleAttribute("hidden",!t),!t){document.title=n,r.innerHTML=r.textContent;return}document.title=`${v(t)} / ${n}`,r.innerHTML=`<a href="?">${r.textContent}</a>`;let i=o.querySelector(".content");i.textContent="Loading...",i.dataset.status="loading";let l=(await H(e))?.entries;if(!l?.length){let a="No relevant entries found.";t.includes(" ")?a+="<br> Try to search one word at a time.":!e.eg&&!e.ge?a+="<br> Try to search with at least one dictionary enabled.":(!e.eg||!e.ge)&&(a+="<br> Try to search with both dictionaries enabled."),i.innerHTML=a,i.dataset.status="warning";return}let s="";for(let{htmlTerm:a,htmlDef:u}of l)s+=`<dt>${a}</dt>
<dd>${u}</dd>
`;i.innerHTML=`<dl>${s}</dl>`,i.dataset.status="loaded"}async function j(){let e=new URLSearchParams(window.location.search),t={q:e.get("q")?.trim()??"",eg:[null,"1"].includes(e.get("eg")),ge:[null,"1"].includes(e.get("ge")),data:{}};if(window.history){let n="";window.location.href.endsWith("?")?n=window.location.pathname:t.q&&e.get("eg")==="1"&&e.get("ge")==="1"&&(e.delete("eg"),e.delete("ge"),n=`?${e.toString()}`),n&&window.history.pushState(null,"",n)}T(t),await k(t)}j();})();
