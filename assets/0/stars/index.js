"use strict";(()=>{var q="https://raw.githubusercontent.com/axtk/x/refs/heads/main/assets/stars/data",E={stars:`${q}/stars_m6.json`,constellationLabels:`${q}/constellation_labels.json`,constellationNames:`${q}/constellation_names.json`,constellationLines:`${q}/constellation_lines.json`},p="http://www.w3.org/2000/svg",X={alp:"\u03B1",bet:"\u03B2",gam:"\u03B3",del:"\u03B4",eps:"\u03B5",zet:"\u03B6",eta:"\u03B7",the:"\u03B8",iot:"\u03B9",kap:"\u03BA",lam:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omi:"\u03BF",pi:"\u03C0",rho:"\u03C1",sig:"\u03C3",tau:"\u03C4",ups:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",ome:"\u03C9",omg:"\u03C9"},Y=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"];function at(t){let o={};for(let n of t){let e=n[5]?.split(", ").at(-1)||`#${n[3]}`;o[e]=[n[0],n[1]]}return o}async function V(){let[t,o,n,e]=await Promise.all([E.stars,E.constellationLabels,E.constellationNames,E.constellationLines].map(i=>fetch(i).then(s=>s.json()))),r=at(t),l=[];for(let[i,s]of Object.entries(e))for(let a of s){let u=[];for(let m of a){let c;m.includes(" #")||m.startsWith("#")?c=m.split(" ").at(-1):!m.includes(" ")&&i!=="_"?c=`${m} ${i}`:c=m,c&&r[c]&&u.push(r[c])}u.length!==0&&l.push(u)}return{stars:t,constellationLabels:o,constellationNames:n,constellationLines:l}}var v=null,B="";function C({element:t}){let o=t.getAttribute("data-size");if(o===B&&v!==null)return v;let n=Number(t.getAttribute("width")),e=Number(t.getAttribute("height"));return v={width:n,height:e,r:Math.sqrt(n*n+e*e)/1.65,x0:n/2,y0:e/2},B=o,v}var{sin:y,cos:b}=Math;function f(t,o,n){let{tilt:[e,r]}=n,{width:l,height:i,x0:s,y0:a,r:u}=C(n),m=u*b(o)*b(t),c=u*y(o),A=u*b(o)*y(t),z=m*b(e)+A*y(e),L=c,M=-m*y(e)+A*b(e),$=z,F=L*b(r)-M*y(r),D=L*y(r)+M*b(r);return D<0||$<-.75*l||$>1.75*l||F<-.75*i||F>1.75*i?null:[s+$,a-F,D]}var{PI:d}=Math,k=d/100,w=d/12,_=d/50;function I(t){let o=t.element.querySelector("g.grid"),n=o.querySelector("path");n||(n=document.createElementNS(p,"path"),o.appendChild(n));let e,r="",l="";for(let i=-d/2+w;i<=d/2-w+k;i+=w){let s="",a=!1;for(let u=0;u<=2*d+k;u+=_){if(e=f(u,i,t),l=s&&!a?" L":"M",e===null){a=!0;continue}a&&(a=!1),s+=`${l}${e[0].toFixed(3)},${e[1].toFixed(3)}`}r+=`${r?" ":""}${s}`}for(let i=0;i<=2*d-w+k;i+=w){let s="",a=!1;for(let u=-d/2;u<=d/2+k;u+=_){if(e=f(i,u,t),l=s&&!a?" L":"M",e===null){a=!0;continue}a&&(a=!1),s+=`${l}${e[0].toFixed(3)},${e[1].toFixed(3)}`}r+=`${r?" ":""}${s}`}n.setAttribute("d",r)}function S(t,o){return o.mode==="fantasy"?2*(6.75-t[2]):.5*(6.75-t[2])}var{floor:T,random:g,sin:K,cos:H,PI:O}=Math;function ut(){return`#${["","",""].map(()=>T(50+120*g()).toString(16)).join("")}`}var mt=30,P=[];function ft(){if(P.length===mt)return P[T(g()*P.length)];let t="",o=Array.from({length:2}).map(()=>ut());for(let n=0;n<2;n++)for(let e=.25*n;e<5;e++){let r=2*O*g(),l=5+e*H(r),i=5+e*K(r),s=r+O*(.5+.5*g()),a=5+e*H(s),u=5+e*K(s),m=o[T(g()*o.length)];t+=`<path d="M${l} ${i} A ${e} ${e} 0 1 0 ${a} ${u}" stroke="${m}" stroke-width="${(.75+g()).toFixed(3)}" stroke-opacity="${(.35+.55*g()).toFixed(3)}"/>`}return P.push(t),t}function W(t){let o=t.element.querySelector("g.stars"),n=Array.from(o.querySelectorAll("svg")),e=null;for(let m of o.querySelectorAll("circle"))m.remove();let r,l,i,s,a,u=0;for(let m=0;m<t.stars.length;m++)r=t.stars[m],i=f(r[0],r[1],t),i!==null&&(l=n[u++],l||(e||(e=document.createDocumentFragment()),l=document.createElementNS(p,"svg"),l.setAttribute("viewBox","0 0 10 10"),l.innerHTML=ft(),e.appendChild(l)),s=S(r,t),a=(2*s).toFixed(3),l.setAttribute("x",(i[0]-s).toFixed(3)),l.setAttribute("y",(i[1]-s).toFixed(3)),l.setAttribute("width",a),l.setAttribute("height",a),l.setAttribute("data-spcl",r[4]));e&&o.appendChild(e);for(let m=u;m<n.length;m++)n[m].remove()}function J(t){if(t.mode==="fantasy")return W(t);let o=t.element.querySelector("g.stars"),n=Array.from(o.querySelectorAll("circle")),e=null;for(let a of o.querySelectorAll("svg"))a.remove();let r,l,i,s=0;for(let a=0;a<t.stars.length;a++)r=t.stars[a],i=f(r[0],r[1],t),i!==null&&(l=n[s++],l||(e||(e=document.createDocumentFragment()),l=document.createElementNS(p,"circle"),e.appendChild(l)),l.setAttribute("cx",i[0].toFixed(3)),l.setAttribute("cy",i[1].toFixed(3)),l.setAttribute("r",S(r,t).toFixed(3)),l.setAttribute("data-spcl",r[4]));e&&o.appendChild(e);for(let a=s;a<n.length;a++)n[a].remove()}function pt(t){if(!t[5])return;let n=t[5].split(", ").at(-1)?.split(" ")?.[0]?.match(/^([^\d]+)(\d+)?$/);if(!n||n.length<2)return;let e=X[n[1]]??n[1]??"";if(!e)return;let r=n[2]?Y[Number(n[2])]??"":"";return`${e}${r}`}function Q(t){let o=t.element.querySelector("g.star-labels"),n=Array.from(o.querySelectorAll("text")),e=null,r,l,i,s,a=0;for(let u=0;u<t.stars.length;u++){if(r=t.stars[u],l=pt(r),!l||(s=f(r[0],r[1],t),s===null))continue;i=n[a++],i||(e||(e=document.createDocumentFragment()),i=document.createElementNS(p,"text"),e.appendChild(i));let m=S(r,t);i.setAttribute("x",(s[0]+m+2).toFixed(3)),i.setAttribute("y",(s[1]+2).toFixed(3)),i.setAttribute("data-x",r[2]<3?"1":"0"),i.textContent=l}e&&o.appendChild(e);for(let u=a;u<n.length;u++)n[u].remove()}function ct(t,o){if(t[2])return o.constellationNames[t[2]]??t[2]}function U(t){let o=t.element.querySelector("g.constellation-labels"),n=Array.from(o.querySelectorAll("text")),e=null,r,l,i,s,a=0;for(let u=0;u<t.constellationLabels.length;u++)r=t.constellationLabels[u],l=ct(r,t),!(!r[2]||!l)&&(s=f(r[0],r[1],t),s!==null&&(i=n[a++],i||(e||(e=document.createDocumentFragment()),i=document.createElementNS(p,"text"),e.appendChild(i)),i.setAttribute("x",s[0].toFixed(3)),i.setAttribute("y",s[1].toFixed(3)),i.textContent=l));e&&o.appendChild(e);for(let u=a;u<n.length;u++)n[u].remove()}function Z(t){let o=t.element.querySelector("g.constellation-lines"),n=Array.from(o.querySelectorAll("path")),e=null,r,l,i,s,a=0;for(let u=0;u<t.constellationLines.length;u++){r=t.constellationLines[u],l="";for(let m of r)s=f(m[0],m[1],t),s!==null&&(l+=`${l?" L":"M"}${s[0]},${s[1]}`);l&&(i=n[a++],i||(e||(e=document.createDocumentFragment()),i=document.createElementNS(p,"path"),e.appendChild(i)),i.setAttribute("d",l))}e&&o.appendChild(e);for(let u=a;u<n.length;u++)n[u].remove()}function x(t){I(t),J(t),Q(t),U(t),Z(t)}var{PI:G,asin:tt}=Math;function dt(t,o=0,n=2*G){for(;t<o;)t+=n-o;for(;t>=n;)t-=n-o;return t}var h=!1;function et(t,o,n){let{tilt:e}=t,{r}=C(t),l=tt(o/r),i=tt(n/r),s=e[0]+l,a=e[1]+i;e[0]=dt(s),a>=-G/2&&a<=G/2&&(e[1]=a),h||(requestAnimationFrame(()=>{x(t),h=!1}),h=!0)}function bt(t){let{element:o}=t,n=null,e=null;o.addEventListener("mousedown",r=>{n=r.offsetX,e=r.offsetY,h=!1}),o.addEventListener("mouseup",()=>{n=null,e=null,h=!1}),o.addEventListener("mousemove",r=>{n!==null&&e!==null&&(et(t,r.offsetX-n,r.offsetY-e),n=r.offsetX,e=r.offsetY)})}function gt(t){let{element:o}=t,n=null,e=null;o.addEventListener("touchstart",r=>{n=r.changedTouches[0].pageX,e=r.changedTouches[0].pageY,h=!1}),o.addEventListener("touchend",()=>{n=null,e=null,h=!1}),o.addEventListener("touchmove",r=>{n!==null&&e!==null&&(et(t,r.changedTouches[0].pageX-n,r.changedTouches[0].pageY-e),n=r.changedTouches[0].pageX,e=r.changedTouches[0].pageY)})}function nt(t){bt(t),gt(t)}var{sin:N,cos:R,asin:ht,atan2:Ct,sqrt:yt}=Math;function rt(t,o,n){let{tilt:[e,r]}=n,{r:l,x0:i,y0:s}=C(n),a=t-i,u=s-o,m=l*l-a*a-u*u;if(m<0)return null;let c=yt(m),A=a,z=u*R(-r)-c*N(-r),L=u*N(-r)+c*R(-r),M=A*R(-e)+L*N(-e),$=z,F=-A*N(-e)+L*R(-e),D=ht($/l),st=Ct(F,M);return[D,st]}var{abs:ot}=Math,lt=5;function St(t,o){return t[2]-o[2]}function it(t){document.addEventListener("click",o=>{if(!t.element.contains(o.target))return;let{left:n,top:e}=t.element.getBoundingClientRect(),r=o.offsetX-n,l=o.offsetY-e;if(rt(r,l,t)===null)return;let i=[];for(let s of t.stars){let a=f(s[0],s[1],t);a!==null&&ot(a[0]-r)<=lt&&ot(a[1]-l)<=lt&&i.push(s)}i.sort(St);for(let s of i)console.log(`#${s[3]}; ${s[5]}`,s[2])})}function j({element:t}){let o=t.parentElement;if(!o)return;t.setAttribute("style","display: none");let{width:n,height:e}=o.getBoundingClientRect();t.setAttribute("width",String(n)),t.setAttribute("height",String(e)),t.setAttribute("viewBox",`0 0 ${n} ${e}`),t.setAttribute("data-size",Math.random().toString(36).slice(2)),t.removeAttribute("style")}async function xt(){let t=document.querySelector("#screen svg"),n={...await V(),element:t,tilt:[-.12,0],mode:document.documentElement.dataset.mode},e=null;window.addEventListener("resize",()=>{e!==null&&cancelAnimationFrame(e),e=requestAnimationFrame(()=>{j(n),x(n)})}),document.querySelector("#screen form").addEventListener("change",r=>{let l=r.target;if(l instanceof HTMLInputElement&&l.name==="mode"){let i=n.mode;document.documentElement.dataset.mode=l.value,n.mode=l.value,(n.mode==="fantasy"||i==="fantasy")&&x(n)}}),j(n),x(n),nt(n),it(n)}xt();})();
