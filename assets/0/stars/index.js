"use strict";(()=>{var k="https://raw.githubusercontent.com/axtk/x/refs/heads/main/assets/stars/data",F={stars:`${k}/stars_m6.json`,constellationLabels:`${k}/constellation_labels.json`,constellationNames:`${k}/constellation_names.json`,constellationLines:`${k}/constellation_lines.json`},p="http://www.w3.org/2000/svg",X={alp:"\u03B1",bet:"\u03B2",gam:"\u03B3",del:"\u03B4",eps:"\u03B5",zet:"\u03B6",eta:"\u03B7",the:"\u03B8",iot:"\u03B9",kap:"\u03BA",lam:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omi:"\u03BF",pi:"\u03C0",rho:"\u03C1",sig:"\u03C3",tau:"\u03C4",ups:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",ome:"\u03C9",omg:"\u03C9"},Y=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"];function at(t){let o={};for(let n of t){let e=n[5]?.split(", ").at(-1)||`#${n[3]}`;o[e]=[n[0],n[1]]}return o}async function _(){let[t,o,n,e]=await Promise.all([F.stars,F.constellationLabels,F.constellationNames,F.constellationLines].map(l=>fetch(l).then(s=>s.json()))),r=at(t),i=[];for(let[l,s]of Object.entries(e))for(let u of s){let a=[];for(let m of u){let c;m.includes(" #")||m.startsWith("#")?c=m.split(" ").at(-1):!m.includes(" ")&&l!=="_"?c=`${m} ${l}`:c=m,c&&r[c]&&a.push(r[c])}a.length!==0&&i.push(a)}return{stars:t,constellationLabels:o,constellationNames:n,constellationLines:i}}var q=null,V="";function C({element:t}){let o=t.getAttribute("data-size");if(o===V&&q!==null)return q;let n=Number(t.getAttribute("width")),e=Number(t.getAttribute("height"));return q={width:n,height:e,r:Math.sqrt(n*n+e*e)/1.65,x0:n/2,y0:e/2},V=o,q}var{sin:S,cos:b}=Math;function f(t,o,n){let{tilt:[e,r]}=n,{width:i,height:l,x0:s,y0:u,r:a}=C(n),m=a*b(o)*b(t),c=a*S(o),x=a*b(o)*S(t),z=m*b(e)+x*S(e),A=c,D=-m*S(e)+x*b(e),L=z,$=A*b(r)-D*S(r),M=A*S(r)+D*b(r);return M<0||L<-.75*i||L>1.75*i||$<-.75*l||$>1.75*l?null:[s+L,u-$,M]}var{PI:d}=Math,P=d/100,w=d/12,B=d/50;function K(t){let o=t.element.querySelector("g.grid"),n=o.querySelector("path");n||(n=document.createElementNS(p,"path"),o.appendChild(n));let e,r="",i="";for(let l=-d/2+w;l<=d/2-w+P;l+=w){let s="",u=!1;for(let a=0;a<=2*d+P;a+=B){if(e=f(a,l,t),i=s&&!u?" L":"M",e===null){u=!0;continue}u&&(u=!1),s+=`${i}${e[0].toFixed(3)},${e[1].toFixed(3)}`}r+=`${r?" ":""}${s}`}for(let l=0;l<=2*d-w+P;l+=w){let s="",u=!1;for(let a=-d/2;a<=d/2+P;a+=B){if(e=f(l,a,t),i=s&&!u?" L":"M",e===null){u=!0;continue}u&&(u=!1),s+=`${i}${e[0].toFixed(3)},${e[1].toFixed(3)}`}r+=`${r?" ":""}${s}`}n.setAttribute("d",r)}function y(t,o){return o.mode==="van_gogh"?2*(6.75-t[2]):.5*(6.75-t[2])}var{floor:T,random:h,sin:I,cos:H,PI:O}=Math;function ut(){return`#${["","",""].map(()=>T(50+120*h()).toString(16)).join("")}`}var mt=30,N=[];function ft(){if(N.length===mt)return N[T(h()*N.length)];let t="",o=Array.from({length:2}).map(()=>ut());for(let n=0;n<2;n++)for(let e=.25*n;e<5;e++){let r=2*O*h(),i=5+e*H(r),l=5+e*I(r),s=r+O*(.5+.5*h()),u=5+e*H(s),a=5+e*I(s),m=o[T(h()*o.length)];t+=`<path d="M${i} ${l} A ${e} ${e} 0 1 0 ${u} ${a}" stroke="${m}" stroke-width="${(.75+h()).toFixed(3)}" stroke-opacity="${(.35+.55*h()).toFixed(3)}"/>`}return N.push(t),t}function W(t){let o=t.element.querySelector("g.stars"),n=Array.from(o.querySelectorAll("svg")),e=null,r,i,l,s,u,a=0;for(let m=0;m<t.stars.length;m++)r=t.stars[m],l=f(r[0],r[1],t),l!==null&&(i=n[a++],i||(e||(e=document.createDocumentFragment()),i=document.createElementNS(p,"svg"),i.setAttribute("viewBox","0 0 10 10"),i.innerHTML=ft(),e.appendChild(i)),s=y(r,t),u=(2*s).toFixed(3),i.setAttribute("x",(l[0]-s).toFixed(3)),i.setAttribute("y",(l[1]-s).toFixed(3)),i.setAttribute("width",u),i.setAttribute("height",u),i.setAttribute("data-spcl",r[4]));e&&o.appendChild(e);for(let m=a;m<n.length;m++)n[m].remove()}function J(t){if(t.mode==="van_gogh")return W(t);let o=t.element.querySelector("g.stars"),n=Array.from(o.querySelectorAll("circle")),e=null,r,i,l,s=0;for(let u=0;u<t.stars.length;u++)r=t.stars[u],l=f(r[0],r[1],t),l!==null&&(i=n[s++],i||(e||(e=document.createDocumentFragment()),i=document.createElementNS(p,"circle"),e.appendChild(i)),i.setAttribute("cx",l[0].toFixed(3)),i.setAttribute("cy",l[1].toFixed(3)),i.setAttribute("r",y(r,t).toFixed(3)),i.setAttribute("data-spcl",r[4]));e&&o.appendChild(e);for(let u=s;u<n.length;u++)n[u].remove()}function pt(t){if(!t[5])return;let n=t[5].split(", ").at(-1)?.split(" ")?.[0]?.match(/^([^\d]+)(\d+)?$/);if(!n||n.length<2)return;let e=X[n[1]]??n[1]??"";if(!e)return;let r=n[2]?Y[Number(n[2])]??"":"";return`${e}${r}`}function Q(t){let o=t.element.querySelector("g.star-labels"),n=Array.from(o.querySelectorAll("text")),e=null,r,i,l,s,u=0;for(let a=0;a<t.stars.length;a++){if(r=t.stars[a],i=pt(r),!i||(s=f(r[0],r[1],t),s===null))continue;l=n[u++],l||(e||(e=document.createDocumentFragment()),l=document.createElementNS(p,"text"),e.appendChild(l));let m=y(r,t);l.setAttribute("x",(s[0]+m+2).toFixed(3)),l.setAttribute("y",(s[1]+2).toFixed(3)),l.setAttribute("data-x",r[2]<3?"1":"0"),l.textContent=i}e&&o.appendChild(e);for(let a=u;a<n.length;a++)n[a].remove()}function ct(t,o){if(t[2])return o.constellationNames[t[2]]??t[2]}function U(t){let o=t.element.querySelector("g.constellation-labels"),n=Array.from(o.querySelectorAll("text")),e=null,r,i,l,s,u=0;for(let a=0;a<t.constellationLabels.length;a++)r=t.constellationLabels[a],i=ct(r,t),!(!r[2]||!i)&&(s=f(r[0],r[1],t),s!==null&&(l=n[u++],l||(e||(e=document.createDocumentFragment()),l=document.createElementNS(p,"text"),e.appendChild(l)),l.setAttribute("x",s[0].toFixed(3)),l.setAttribute("y",s[1].toFixed(3)),l.textContent=i));e&&o.appendChild(e);for(let a=u;a<n.length;a++)n[a].remove()}function Z(t){let o=t.element.querySelector("g.constellation-lines"),n=Array.from(o.querySelectorAll("path")),e=null,r,i,l,s,u=0;for(let a=0;a<t.constellationLines.length;a++){r=t.constellationLines[a],i="";for(let m of r)s=f(m[0],m[1],t),s!==null&&(i+=`${i?" L":"M"}${s[0]},${s[1]}`);i&&(l=n[u++],l||(e||(e=document.createDocumentFragment()),l=document.createElementNS(p,"path"),e.appendChild(l)),l.setAttribute("d",i))}e&&o.appendChild(e);for(let a=u;a<n.length;a++)n[a].remove()}function E(t){K(t),J(t),Q(t),U(t),Z(t)}var{PI:G,asin:tt}=Math;function dt(t,o=0,n=2*G){for(;t<o;)t+=n-o;for(;t>=n;)t-=n-o;return t}var g=!1;function et(t,o,n){let{tilt:e}=t,{r}=C(t),i=tt(o/r),l=tt(n/r),s=e[0]+i,u=e[1]+l;e[0]=dt(s),u>=-G/2&&u<=G/2&&(e[1]=u),g||(requestAnimationFrame(()=>{E(t),g=!1}),g=!0)}function bt(t){let{element:o}=t,n=null,e=null;o.addEventListener("mousedown",r=>{n=r.offsetX,e=r.offsetY,g=!1}),o.addEventListener("mouseup",()=>{n=null,e=null,g=!1}),o.addEventListener("mousemove",r=>{n!==null&&e!==null&&(et(t,r.offsetX-n,r.offsetY-e),n=r.offsetX,e=r.offsetY)})}function ht(t){let{element:o}=t,n=null,e=null;o.addEventListener("touchstart",r=>{n=r.changedTouches[0].pageX,e=r.changedTouches[0].pageY,g=!1}),o.addEventListener("touchend",()=>{n=null,e=null,g=!1}),o.addEventListener("touchmove",r=>{n!==null&&e!==null&&(et(t,r.changedTouches[0].pageX-n,r.changedTouches[0].pageY-e),n=r.changedTouches[0].pageX,e=r.changedTouches[0].pageY)})}function nt(t){bt(t),ht(t)}var{sin:v,cos:R,asin:gt,atan2:Ct,sqrt:St}=Math;function rt(t,o,n){let{tilt:[e,r]}=n,{r:i,x0:l,y0:s}=C(n),u=t-l,a=s-o,m=i*i-u*u-a*a;if(m<0)return null;let c=St(m),x=u,z=a*R(-r)-c*v(-r),A=a*v(-r)+c*R(-r),D=x*R(-e)+A*v(-e),L=z,$=-x*v(-e)+A*R(-e),M=gt(L/i),st=Ct($,D);return[M,st]}var{abs:ot}=Math,lt=5;function yt(t,o){return t[2]-o[2]}function it(t){document.addEventListener("click",o=>{if(!t.element.contains(o.target))return;let{left:n,top:e}=t.element.getBoundingClientRect(),r=o.offsetX-n,i=o.offsetY-e;if(rt(r,i,t)===null)return;let l=[];for(let s of t.stars){let u=f(s[0],s[1],t);u!==null&&ot(u[0]-r)<=lt&&ot(u[1]-i)<=lt&&l.push(s)}l.sort(yt);for(let s of l)console.log(`#${s[3]}; ${s[5]}`,s[2])})}function j({element:t}){let o=t.parentElement;if(!o)return;t.setAttribute("style","display: none");let{width:n,height:e}=o.getBoundingClientRect();t.setAttribute("width",String(n)),t.setAttribute("height",String(e)),t.setAttribute("viewBox",`0 0 ${n} ${e}`),t.setAttribute("data-size",Math.random().toString(36).slice(2)),t.removeAttribute("style")}async function xt(){let t=document.querySelector("#screen svg"),n={...await _(),element:t,tilt:[-.12,0]},e=null;window.addEventListener("resize",()=>{e!==null&&cancelAnimationFrame(e),e=requestAnimationFrame(()=>{j(n),E(n)})}),j(n),E(n),nt(n),it(n)}xt();})();
