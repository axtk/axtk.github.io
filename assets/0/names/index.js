"use strict";(()=>{var M={config:"https://raw.githubusercontent.com/axtk/translit/refs/heads/main/configs/ru.json",chars:"https://raw.githubusercontent.com/axtk/x/refs/heads/main/assets/translit/chars.json"};var F=new Set(["\u0301"]);function G(e){let n={},t=Object.entries(e);for(let r=t.length-1;r>=0;r--){let[o,a]=t[r];if(o.length===1)n[o]={...a,character:o};else{let s=o.split(""),i=s[0],p={...a,character:`${F.has(i)?"\u25CC":""}${i}`};for(let f of s)n[f]=p}}return n}async function I(){let[e,n]=await Promise.all([M.config,M.chars].map(t=>fetch(t).then(r=>r.json())));return{config:e,chars:G(n)}}function H({q:e}){document.querySelector('.input [name="q"]').value=e}var $=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"]];function b(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function h(e){let n=String(e);if(!e)return"";for(let[t,r]of $)n=n.replace(new RegExp(b(t),"g"),r);return n}var ie=$.reverse();function q(e,n){if(n===void 0||n>=e.length)return e;let t=new Set,r=[];for(;r.length<n;){let o=e[Math.floor(e.length*Math.random())],a=JSON.stringify(o);t.has(a)||(r.push(o),t.add(a))}return r}var W=3;function O(e,n){return e===void 0||n===void 0?e??"":e.replace(new RegExp(b(n),"g"),t=>`<span class="mark">${h(t)}</span>`)}var j={ru:"\u043F\u043E-\u0440\u0443\u0441\u0441\u043A\u0438",cz:"\u043F\u043E-\u0447\u0435\u0448\u0441\u043A\u0438",sk:"\u043F\u043E-\u0441\u043B\u043E\u0432\u0430\u0446\u043A\u0438",sl:"\u043F\u043E-\u0441\u043B\u043E\u0432\u0435\u043D\u0441\u043A\u0438",pl:"\u043F\u043E-\u043F\u043E\u043B\u044C\u0441\u043A\u0438",sr:"\u043F\u043E-\u0441\u0435\u0440\u0431\u0441\u043A\u0438"};function J(e,n){let t=new Set(Object.keys(n.chars)),r=new Set;for(let o of e.toLowerCase())t.has(o)&&r.add(o);return Array.from(r)}function Y({entries:e,mark:n}){let t=e[0],r=e.slice(1),o=null,a=null,s=document.createElement("td");if(t){let[i,p,f]=t.split("|");o=document.createElement("div"),o.className="entry-content",f&&(o.innerHTML+=`<span class="secondary">${h(f)}</span>&nbsp;\u2192 `),o.innerHTML+=`<strong>${O(p,n)}</strong> <span class="lang">${h(j[i]??i)}</span>`,s.appendChild(o)}if(r?.length){a=document.createElement("div"),a.className="entry-content";for(let i=0;i<r.length;i++){let[p,f,g]=r[i].split("|");a.innerHTML+=(i===0?"":'<span class="sep">, </span>')+`<span><strong class="primary">${O(f,n)}</strong> `+(g?`<span class="secondary">(${h(g)})</span> `:"")+`<span class="lang">${h(j[p]??p)}</span></span>`}s.appendChild(a)}return s}function D(e,n){let t=document.querySelector(".chars"),r=J(e,n);if(t.toggleAttribute("hidden",r.length===0),r.length===0)return;let o=t.querySelector("table");o.innerHTML="";for(let a of r){let{examples:s,character:i}=n.chars[a];s=q(s.filter(f=>f.at(-1)!=="-"),W);let p=document.createElement("tbody");for(let f=0;f<s.length;f++){let g=s[f],c=document.createElement("tr");if(f===0){let l=document.createElement("th");l.rowSpan=s.length,l.textContent=i,c.appendChild(l)}let m=Y({entries:g,mark:i});m.innerHTML&&(c.appendChild(m),p.appendChild(c))}o.appendChild(p)}}function _(e){return e!==null&&typeof e=="object"&&"value"in e&&Array.isArray(e.value)}function U(e,{def:n={}}={}){let t,r;e.length>2&&e.includes(" ")?[r,...t]=e.split(" "):t=[e];for(let o=0;o<t.length;o++)if(t[o].startsWith("#")){let a=t[o].slice(1);a in n&&t.splice(o,1,...n[a])}return{value:t,op:r}}function P(e,n){let t;if(Array.isArray(e)){t=[];for(let r of e)_(r)?t.push(r):Array.isArray(r)?t.push({value:r}):t.push(U(r,n))}else t=[U(e,n)];if(!n.strictCase)for(let r of t)r.value=r.value.map(o=>o.toLowerCase());return t}function Q(e,n){return{key:e.key,from:P("from"in e?e.from:e.key,n),to:P(e.to,n)}}function Z(e){return Array.isArray(e)&&Array.isArray(e[0])}function ee(e){let{map:n=[]}=e;return(Z(n)?n:[n]).map(r=>r.map(o=>Q(o,e)))}function N(e,n={}){if(typeof e!="string")throw new Error("Input should be a string");let t=e.split(""),r=t.slice(),o=new Array(t.length).fill(!1),a=new Array(t.length).fill(!1),s=new Array(t.length).fill(!1),i=ee(n);for(let f of i){let{ignore:g=[]}=n,c=l=>l&&!n.strictCase?l.toLowerCase():l,m=g.map(c);for(let l=0;l<t.length;l++){let x=c(t[l]);if(m.includes(x))continue;let z=t[l].toLowerCase(),L=t[l].toUpperCase();o[l]=L!==z&&t[l]===L;for(let{key:X,from:E,to:R}of f){if(x!==X||s[l])continue;let v=E.findIndex(u=>u.value.length===1&&u.value[0]===x);if(v===-1)continue;let d=[],y=l;for(;d.length<v+1;){let u=c(t[y]);m.includes(u)||d.push([u,y]),y--}for(d.reverse(),y=l+1;d.length<E.length;){let u=c(t[y]);m.includes(u)||d.push([u,y]),y++}let S=d.length!==0;for(let u=0;u<d.length&&S;u++){let[C]=d[u],w=E[u];if(!w){S=!1;break}let{value:V,op:A}=w,k=C!==void 0&&V.includes(C);S&&=(A==="NOT"?!k:k)&&(A!=="OTHER"||x!==C)}if(S)for(let u=0;u<E.length;u++){let C=d[u][1],w=R[u].value[0];w!==void 0&&w!=="~"&&(r[C]=w,a[C]=w.length===1||R[u].op==="GLYPH",s[C]=!0)}}}if(f.length!==0)for(let l=0;l<r.length;l++)!s[l]||!o[l]||!r[l]||(a[l]||o[l-1]&&o[l+1]||o[l-2]&&o[l-1]||o[l+1]&&o[l+2]?r[l]=r[l].toUpperCase():r[l]=r[l][0].toUpperCase()+r[l].slice(1))}let p=r.join("");return{input:e,inputGlyphs:t,output:p,outputGlyphs:r,isUpperCase:o}}var T="\u0301";function B(e,n){let{inputGlyphs:t,outputGlyphs:r}=N(e,n),o="",a="",s="";for(let p=0;p<r.length;p++){let f=t[p],g=t[p+1],c=r[p];if(f!==T)if(g===T){let m=h(o),l=h(c);a+=`${m}<u>${l}</u>`,s+=`${m.toUpperCase()}<u>${l.toUpperCase()}</u>`,o=""}else o+=c}if(o){let p=h(o);a+=p,s+=p.toUpperCase()}let i=e.replaceAll(T,"");return{output:a,uppercaseOutput:s,unstressedInput:i}}function K(e){let{q:n,config:t}=e;if(!n){document.documentElement.dataset.output="none";return}let r=document.querySelector(".output"),{output:o,uppercaseOutput:a,unstressedInput:s}=B(n,t);r.querySelector(".result strong").innerHTML=o;let i=r.querySelector(".result .uppercased");i.innerHTML=a,i.toggleAttribute("hidden",o===a),r.querySelector("a.unstress").href=`?q=${encodeURIComponent(s)}`,document.documentElement.dataset.output=n===s?"unstressed":"stressed",D(o,e)}async function te(){window.history&&window.location.href.endsWith("?")&&window.history.pushState(null,"",window.location.pathname);let n={...await I(),q:new URLSearchParams(window.location.search).get("q")?.trim()??""};H(n),K(n)}te();})();
