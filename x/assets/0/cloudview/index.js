"use strict";(()=>{function $(t){return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function M(t){let e=[],n="",i=!1;for(let r of t){if(r===","&&!i){e.push($(n)),n="";continue}r==='"'&&(i=!i),n+=r}return n&&e.push($(n)),e}var v=null;function P(t){if(v)return v;let e=t.split(/\r?\n/).map(i=>i.trim()).filter(i=>i!=="");if(e.length===0)return null;let n={};for(let i of e){let[r,o,a]=M(i);r&&(n[r]={description:o,location:a})}return n}function S({name:t},e){if(!t||!e.indexContent)return;let n=P(e.indexContent);if(!n)return;let i=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/).slice(0,2),r=i.join("_");if(n[r])return n[r].description;let o=null;for(let a=i.length;a>0;a--){r=i.slice(0,a).join("_");for(let d of Object.keys(n)){let f=d.endsWith("*")?d.replace(/\*+$/,""):d;r.startsWith(f)&&(!o||o.length<d.length)&&(o=d)}}if(o)return n[o].description}function L({name:t},e){if(!t)return;let i=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/)[0]?.match(/^(\d{4})[-_]?(\d\d)?[-_]?(\d\d)?$/);if(!(!i||i.length<2))return i.slice(1,e.dateFormat==="short"?3:4).filter(r=>r!==void 0).join("-")}function m(t){let e=new URLSearchParams(window.location.search),n=new URLSearchParams,i=e.get("u"),r=e.get("i"),o=e.get("t");i&&n.set("u",i),r&&n.set("i",r),o&&n.set("t",o);let a=n.toString();return a?a+(t??""):""}var k=null;function R(t){if(!(!t.items?.length||!t.container)&&(k||(k=t.container instanceof Element?t.container:document.querySelector(t.container)),!!k)){for(let e of t.items){let n=document.createElement("figure"),i=`https://night-salad.vercel.app/?u=${encodeURIComponent(e.url??"")}`,r=t.getDisplayedDate?.(e,t),o=t.getDescription?.(e,t),a=`?${m("&")}k=${encodeURIComponent(e.index??"")}&n=${encodeURIComponent(e.name??"")}`;e.id&&(n.id=e.id),e.name&&(n.dataset.name=e.name),n.innerHTML=`<picture><img src="${i}" alt="${e.name??""}" height="300" loading="lazy"></picture><figcaption><span class="content">`+(r?`<span class="date">${r}</span> `:"")+(o?`<span class="description">${o}</span> `:"")+'</span><span class="controls">'+(t.mode==="list"?`<a href="${a}" title="\u041D\u0430 \u0432\u0435\u0441\u044C \u044D\u043A\u0440\u0430\u043D">\u231E\u231D</a>`:"")+"</span></figcaption>",k.appendChild(n)}for(let e of k.querySelectorAll("img")){if(e.complete){e.classList.add("complete");continue}e.addEventListener("load",()=>{e.classList.add("complete")})}}}var h=null;function U(t,e){if(e===void 0||!h)return;let n=h.querySelector(`[data-key="${t}"]`);n&&(n.href=e)}function g(t,e,n){if(n===void 0)return;let i=n<1?`?${m()}`:`?${m("&")}${`${encodeURIComponent(e)}=${encodeURIComponent(n)}`}`;U(t,i)}function q(t){if(t.navContainer&&(h||(h=t.navContainer instanceof Element?t.navContainer:document.querySelector(t.navContainer)),!!h)){if(t.mode==="list"){h.innerHTML='<a title="\u041D\u0430 \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="start">\u25C0\u25C0</a> <a title="\u041D\u0430 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2190]" data-key="prev">\u25C0</a> '+(t.homePage?`<a href="${t.homePage}" title="\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E" data-key="quit">\u25C6</a> `:"")+'<a title="\u041D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2192]" data-key="next">\u25B6</a> <a title="\u041D\u0430 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044E\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="end">\u25B6\u25B6</a>';let{startIndex:e,pageSize:n,total:i}=t;if(e!==void 0&&n&&i!==void 0){let r=(Math.ceil(i/n)-1)*n;g("start","s",e===0?void 0:0),g("prev","s",e===0?void 0:e-n),g("next","s",e<r?Math.min(e+n,r):void 0),g("end","s",e<r?r:void 0)}}if(t.mode==="standalone"){h.innerHTML='<a title="\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0430\u044F [\u2190]" data-key="prev">\u25C0</a> <a title="\u041A \u0441\u043F\u0438\u0441\u043A\u0443" data-key="quit">\u2630</a> <a title="\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F [\u2192]" data-key="next">\u25B6</a>';let{fileIndex:e,pageSize:n}=t;if(e!==void 0&&n){let i=Math.floor(e/n)*n;g("prev","k",e===0?void 0:e-1),g("next","k",e+1);let r=`?${i>0?`${m("&")}s=${i}`:m()}`,o=`#${t.items?.[0]?.id??""}`;U("quit",`${r}${o}`)}}}}function V(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function j(t){return typeof t=="string"&&/^(\w+:)?\/\//.test(t)}var G="https://0.cc";function N({request:t,target:e,endpoint:n}){let i=t?.method,r=t?.url??t?.path;if(e&&/^[A-Z]+\s/.test(e)){let[u,l]=e.split(/\s+/);i||(i=u),r||(r=l)}let o,a=j(r);if(r&&a)o=new URL(r);else if(o=new URL(n,G),a=j(n),r){let u=o.pathname;u||(o.pathname=r),u.endsWith("/")&&(u=u.slice(0,-1)),r.startsWith("/")&&(r=r.slice(1)),o.pathname=u+"/"+r}let d=t?.query,f=t?.params;if(d)for(let[u,l]of Object.entries(d))l!=null&&o.searchParams.append(u,String(l));if(f)for(let[u,l]of Object.entries(f))l!=null&&(o.pathname=o.pathname.replace(new RegExp(`:${V(u)}\\b`,"g"),String(l)));let{href:s,pathname:c,search:p,hash:w}=o;return{method:i,url:a?s:c+p+w}}function Q(t){if(!t)return;let e={};for(let[n,i]of Object.entries(t))i!=null&&(e[n]=typeof i=="string"?i:JSON.stringify(i));return e}var A=class{handler;constructor(t){this.handler=t}send(t,e){if(!this.handler)throw new Error("Missing request handler");return this.handler(t,e)}use(t){this.handler=t}getEntry(t){let e={};for(let[n,i]of Object.entries(t))e[n]=r=>this.send(i,r);return e}getQueryEntry(t){let e={};for(let[n,i]of Object.entries(t))e[n]=r=>this.send(i,{query:r});return e}},W="RequestError",z="Unspecified";function x(t,e){if(!(!t||typeof t!="object"||!(e in t)))return t[e]}var H=class C extends Error{data;status;statusText;constructor(e){let n={status:x(e,"status"),statusText:x(e,"statusText"),message:x(e,"message"),name:x(e,"name"),data:x(e,"data")},i=[n.status,n.statusText].filter(Boolean).join(" ");super(n.message||i||z),this.name=n.name??W,this.status=Number(n.status??0),this.statusText=String(n.statusText??""),this.data=n.data,Object.setPrototypeOf(this,C.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C)}},B="https://cloud-api.yandex.net/v1",F=class extends H{};function J(t={}){let e;return"transformInput"in t?e=t.transformInput:e=({target:n,request:i})=>{let{method:r,url:o}=N({request:i,target:n,endpoint:t.endpoint??B});return[o,{method:r,headers:Q({Accept:"application/json","Content-Type":"application/json",Authorization:t.token?`OAuth ${t.token}`:void 0,...i?.headers,...t.headers}),body:i?.body?JSON.stringify(i?.body):void 0}]},new A(async(n,i)=>{let r=await fetch(...e({target:n,request:i})),{ok:o,status:a,statusText:d}=r;if(!o){let f={status:a,statusText:d};try{f.data=await r.json()}catch{}throw new F(f)}return{ok:o,status:a,statusText:d,body:await r.json()}})}function D(t={}){let e=J(t);return{public:e.getQueryEntry({info:"GET /disk/public/resources",list:"GET /disk/resources/public",download:"GET /disk/public/resources/download",save:"POST /disk/public/resources/save-to-disk"}),storage:e.getQueryEntry({info:"GET /disk"}),...e.getQueryEntry({info:"GET /disk/resources",list:"GET /disk/resources/files",recent:"GET /disk/resources/last-uploaded",create:"PUT /disk/resources",copy:"POST /disk/resources/copy",move:"POST /disk/resources/move",remove:"DELETE /disk/resources",publish:"PUT /disk/resources/publish",unpublish:"PUT /disk/resources/unpublish",upload:"GET /disk/resources/upload",uploadFromURL:"POST /disk/resources/upload",download:"GET /disk/resources/download",operation:"GET /disk/operations"}),...e.getEntry({update:"PATCH /disk/resources"}),trash:e.getQueryEntry({clear:"DELETE /disk/trash/resources",restore:"PUT /disk/trash/resources/restore"})}}var E=D();function y(t,e){if(t)return`/${[...t.split("/"),e].filter(Boolean).join("/")}`;if(e)return`/${e}`}async function O(t){let{index:e,url:n,path:i}=t,r,o;if(typeof e=="string"?e.startsWith("https://")?r=e:o=e:e&&(r=e.url,o=e.path),r||(o||(o=i?`${i}.csv`:"_index.csv"),r=n),!r)return{ok:!0,content:null};try{console.log("index",{public_key:r,path:y(o)});let{ok:a,body:d}=await E.public.download({public_key:r,path:y(o)});if(!a||!d)return{ok:a,content:null};let f=`https://night-salad.vercel.app/?u=${encodeURIComponent(d.href)}`;return{ok:!0,content:await(await fetch(f)).text()}}catch{return{ok:!1,content:null}}}async function _(t){let{url:e,path:n,startIndex:i,fileIndex:r,fileName:o,pageSize:a,sort:d,cropPreview:f}=t;if(!e)return{ok:!1,items:[]};let s={public_key:e,sort:d};o?s.path=y(n,o):r!==void 0&&!isNaN(r)?(s.path=y(n),s.offset=r,s.limit=1):(s.path=y(n),s.offset=i,s.limit=a,s.preview_size="1024x",s.preview_crop=!!f);let{ok:c,body:p}=await E.public.info(s);if(!c||!p)return{ok:c,items:[]};let u=(s.offset===void 0?[p]:p._embedded?.items??[]).map((l,b)=>({id:l.resource_id&&`x${l.resource_id.slice(-10)}`,name:l.name,index:s.offset===void 0?void 0:s.offset+b,url:t.mode==="list"?l.preview:l.file,date:l.created,exifDate:l.exif?.date_time}));return{ok:c,items:u,total:p._embedded?.total}}async function be(t){if(window.history){let{href:u,pathname:l,search:b,hash:T}=window.location,I="";/(\?#?|\??#)$/.test(u)?I=l:/\?#.+$/.test(u)&&(I=l+T),I&&window.history.pushState(null,"",I),T&&setTimeout(()=>{window.history.pushState(null,"",l+b)},2e3)}let e=new URLSearchParams(window.location.search),n=e.get("s")?.trim(),i=e.get("k")?.trim(),r=e.get("n")?.trim(),{url:o,path:a,index:d,...f}=t,s={url:e.get("u")||o,path:e.get("t")||a,index:e.get("i")||d,pageSize:60,sort:"-exif.date_time",startIndex:n&&parseInt(n,10)||0,fileIndex:i?parseInt(i,10):void 0,fileName:r||void 0,mode:document.documentElement.classList.contains("standalone")?"standalone":"list",getDisplayedDate:L,getDescription:S,renderItems:R,renderNav:q,...f};typeof s.fileIndex=="number"&&isNaN(s.fileIndex)&&(s.fileIndex=void 0);let[{items:c,total:p},w]=await Promise.all([_(s),O(s)]);document.documentElement.classList.remove("loading"),s.items=c,s.total=p,s.indexContent=w.content,s.renderItems?.(s),s.renderNav?.(s)}})();
