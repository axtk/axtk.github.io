"use strict";(()=>{var z=Object.create;var _=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var X=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ee=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of F(e))!Z.call(t,r)&&r!==n&&_(t,r,{get:()=>e[r],enumerable:!(i=W(e,r))||i.enumerable});return t};var te=(t,e,n)=>(n=t!=null?z(J(t)):{},ee(e||!t||!t.__esModule?_(n,"default",{value:t,enumerable:!0}):n,t));var j=X(k=>{"use strict";var O=["SCALAR","BLOCK_MAP","KEY","VALUE","BLOCK_SEQ","BLOCK_ENTRY","BLOCK_END","DOCUMENT_END"];function P(t,e,n,i,r){if(e.length===0||n>e[e.length-1])e.push(n),r.push(t,i,i);else for(;e.length&&n!==e[e.length-1];)e.pop(),r.push(6,i,i)}function M(t){let e=0,n=[],i=[],r=t.length,s=0;for(;e<=r;){let o=e,l=t.charCodeAt(e++);if(l===35)for(;e<r&&t.charCodeAt(e)!==10;)e++;else if(l===10){for(;e<r&&t.charCodeAt(e)===32;)e++;s=e-o-1}else if(l===32)for(;e<r&&t.charCodeAt(e)===32;)e++;else if(l===45&&t.charCodeAt(e)===32)e++,s++,P(4,i,s,o,n),n.push(5,o,o),s++;else if(l===45&&t.charCodeAt(e)===10)P(4,i,s,o,n),n.push(5,o,o);else{let u=0;for(;e<=r;){if(l=t.charCodeAt(e),l===10||e===r||l===35&&u>0){n.push(0,o,e-u);break}else if(l===58&&(l=t.charCodeAt(e+1),l===32||l===10)){P(1,i,s,o,n),n.push(2,o,o),n.push(0,o,e-u),n.push(3,e,e),e++;break}u=l===32?u+1:0,e++}}}for(let o=0;o<i.length;o++)n.push(6,r,r);return n.push(7,r,r),n}function me(t,e){let n=0,i=e[0],r,s;function o(a){return i===a?(r=e[n+1],s=e[n+2],n+=3,i=e[n],!0):!1}function l(a){if(!o(a))throw new Error(`Expected ${O[a]}, got ${O[i]}.`)}function u(){if(o(0))return t.slice(r,s);if(o(4)){let a=[];for(;o(5);)a.push(u());return l(6),a}else if(o(1)){let a={};for(;o(2);){l(0);let p=t.slice(r,s);l(3),a[p]=u()}return l(6),a}else return null}return u()}function q(t){return me(t,M(t))}k.parse=q;k.parseTokens=q;k.tokenize=M;k.types=O});function b(t){return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function ne(t){let e=[],n="",i=!1;for(let r of t){if(r===","&&!i){e.push(b(n)),n="";continue}r==='"'&&(i=!i),n+=r}return n&&e.push(b(n)),e}var S=null;function $(t){return!S&&t.index?.length&&(S=t.index.map(({content:e})=>{if(!e)return null;let n=e.split(/\r?\n/).map(r=>r.trim()).filter(r=>r!=="").slice(1);if(n.length===0)return null;let i={};for(let r of n){let[s,o,l]=ne(r);s&&(i[s]={description:o,location:l})}return i}).filter(e=>e!==null)),S}function R({name:t},e){if(!t)return;let n=$(e);if(!n?.length)return;let i=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/).slice(0,2),r=i.join("_"),s=null,o=null;for(let l=0;l<n.length;l++){let u=n[l];if(u[r])return u[r].description;for(let a=i.length;a>0;a--){r=i.slice(0,a).join("_");for(let p of Object.keys(u)){let c=p.endsWith("*")?p.replace(/\*+$/,""):p;r.startsWith(c)&&(!o||o.length<p.length)&&(o=p,s=l)}}}if(s!==null&&o!==null)return n[s]?.[o]?.description}function v({name:t},e){if(!t)return;let i=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/)[0]?.match(/^(\d{4})[-_]?(\d\d)?[-_]?(\d\d)?$/);if(!(!i||i.length<2))return i.slice(1,e.dateFormat==="short"?3:4).filter(r=>r!==void 0).join("-")}function h(t){let e=new URLSearchParams(window.location.search),n=new URLSearchParams,i=e.get("u"),r=e.get("i"),s=e.get("t");i&&n.set("u",i),r&&n.set("i",r),s&&n.set("t",s);let o=n.toString();return o?o+(t??""):""}var C=null;function N(t){if(!(!t.items?.length||!t.container)&&(C||(C=t.container instanceof Element?t.container:document.querySelector(t.container)),!!C)){for(let e of t.items){let n=document.createElement("figure"),i=`https://night-salad.vercel.app/?u=${encodeURIComponent(e.url??"")}`,r=t.getDisplayedDate?.(e,t),s=t.getDescription?.(e,t),o=`?${h("&")}k=${encodeURIComponent(e.index??"")}&n=${encodeURIComponent(e.name??"")}`;e.id&&(n.id=e.id),e.name&&(n.dataset.name=e.name),n.innerHTML=`<picture><img src="${i}" alt="${e.name??""}" height="300" loading="lazy"></picture><figcaption><span class="content">`+(r?`<span class="date">${r}</span> `:"")+(s?`<span class="description">${s}</span> `:"")+'</span><span class="controls">'+(t.mode==="list"?`<a href="${o}" title="\u041D\u0430 \u0432\u0435\u0441\u044C \u044D\u043A\u0440\u0430\u043D">\u231E\u231D</a>`:"")+"</span></figcaption>",C.appendChild(n)}for(let e of C.querySelectorAll("img")){if(e.complete){e.classList.add("complete");continue}e.addEventListener("load",()=>{e.classList.add("complete")})}}}var g=null;function K(t,e){if(e===void 0||!g)return;let n=g.querySelector(`[data-key="${t}"]`);n&&(n.href=e)}function y(t,e,n){if(n===void 0)return;let i=n<1?`?${h()}`:`?${h("&")}${`${encodeURIComponent(e)}=${encodeURIComponent(n)}`}`;K(t,i)}function D(t){if(t.navContainer&&(g||(g=t.navContainer instanceof Element?t.navContainer:document.querySelector(t.navContainer)),!!g)){if(t.mode==="list"){g.innerHTML='<a title="\u041D\u0430 \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="start">\u25C0\u25C0</a> <a title="\u041D\u0430 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2190]" data-key="prev">\u25C0</a> '+(t.homePage?`<a href="${t.homePage}" title="\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E" data-key="quit">\u25C6</a> `:"")+'<a title="\u041D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2192]" data-key="next">\u25B6</a> <a title="\u041D\u0430 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044E\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="end">\u25B6\u25B6</a>';let{startIndex:e,pageSize:n,total:i}=t;if(e!==void 0&&n&&i!==void 0){let r=(Math.ceil(i/n)-1)*n;y("start","s",e===0?void 0:0),y("prev","s",e===0?void 0:e-n),y("next","s",e<r?Math.min(e+n,r):void 0),y("end","s",e<r?r:void 0)}}if(t.mode==="standalone"){g.innerHTML='<a title="\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0430\u044F [\u2190]" data-key="prev">\u25C0</a> <a title="\u041A \u0441\u043F\u0438\u0441\u043A\u0443" data-key="quit">\u2630</a> <a title="\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F [\u2192]" data-key="next">\u25B6</a>';let{fileIndex:e,pageSize:n}=t;if(e!==void 0&&n){let i=Math.floor(e/n)*n;y("prev","k",e===0?void 0:e-1),y("next","k",e+1);let r=`?${i>0?`${h("&")}s=${i}`:h()}`,s=`#${t.items?.[0]?.id??""}`;K("quit",`${r}${s}`)}}}}function re(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function B(t){return typeof t=="string"&&/^(\w+:)?\/\//.test(t)}var ie="https://0.cc";function se({request:t,target:e,endpoint:n}){let i=t?.method,r=t?.url??t?.path;if(e&&/^[A-Z]+\s/.test(e)){let[f,d]=e.split(/\s+/);i||(i=f),r||(r=d)}let s,o=B(r);if(r&&o)s=new URL(r);else if(s=new URL(n,ie),o=B(n),r){let f=s.pathname;f||(s.pathname=r),f.endsWith("/")&&(f=f.slice(0,-1)),r.startsWith("/")&&(r=r.slice(1)),s.pathname=f+"/"+r}let l=t?.query,u=t?.params;if(l)for(let[f,d]of Object.entries(l))d!=null&&s.searchParams.append(f,String(d));if(u)for(let[f,d]of Object.entries(u))d!=null&&(s.pathname=s.pathname.replace(new RegExp(`:${re(f)}\\b`,"g"),String(d)));let{href:a,pathname:p,search:c,hash:m}=s;return{method:i,url:o?a:p+c+m}}function oe(t){if(!t)return;let e={};for(let[n,i]of Object.entries(t))i!=null&&(e[n]=typeof i=="string"?i:JSON.stringify(i));return e}var ae=class{handler;constructor(t){this.handler=t}send(t,e){if(!this.handler)throw new Error("Missing request handler");return this.handler(t,e)}use(t){this.handler=t}getEntry(t){let e={};for(let[n,i]of Object.entries(t))e[n]=r=>this.send(i,r);return e}getQueryEntry(t){let e={};for(let[n,i]of Object.entries(t))e[n]=r=>this.send(i,{query:r});return e}},le="RequestError",ue="Unspecified";function x(t,e){if(!(!t||typeof t!="object"||!(e in t)))return t[e]}var de=class T extends Error{data;status;statusText;constructor(e){let n={status:x(e,"status"),statusText:x(e,"statusText"),message:x(e,"message"),name:x(e,"name"),data:x(e,"data")},i=[n.status,n.statusText].filter(Boolean).join(" ");super(n.message||i||ue),this.name=n.name??le,this.status=Number(n.status??0),this.statusText=String(n.statusText??""),this.data=n.data,Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T)}},fe="https://cloud-api.yandex.net/v1",pe=class extends de{};function ce(t={}){let e;return"transformInput"in t?e=t.transformInput:e=({target:n,request:i})=>{let{method:r,url:s}=se({request:i,target:n,endpoint:t.endpoint??fe});return[s,{method:r,headers:oe({Accept:"application/json","Content-Type":"application/json",Authorization:t.token?`OAuth ${t.token}`:void 0,...i?.headers,...t.headers}),body:i?.body?JSON.stringify(i?.body):void 0}]},new ae(async(n,i)=>{let r=await fetch(...e({target:n,request:i})),{ok:s,status:o,statusText:l}=r;if(!s){let u={status:o,statusText:l};try{u.data=await r.json()}catch{}throw new pe(u)}return{ok:s,status:o,statusText:l,body:await r.json()}})}function U(t={}){let e=ce(t);return{public:e.getQueryEntry({info:"GET /disk/public/resources",list:"GET /disk/resources/public",download:"GET /disk/public/resources/download",save:"POST /disk/public/resources/save-to-disk"}),storage:e.getQueryEntry({info:"GET /disk"}),...e.getQueryEntry({info:"GET /disk/resources",list:"GET /disk/resources/files",recent:"GET /disk/resources/last-uploaded",create:"PUT /disk/resources",copy:"POST /disk/resources/copy",move:"POST /disk/resources/move",remove:"DELETE /disk/resources",publish:"PUT /disk/resources/publish",unpublish:"PUT /disk/resources/unpublish",upload:"GET /disk/resources/upload",uploadFromURL:"POST /disk/resources/upload",download:"GET /disk/resources/download",operation:"GET /disk/operations"}),...e.getEntry({update:"PATCH /disk/resources"}),trash:e.getQueryEntry({clear:"DELETE /disk/trash/resources",restore:"PUT /disk/trash/resources/restore"})}}var A=U();function E(t,e){if(t)return`/${[...t.split("/"),e].filter(Boolean).join("/")}`;if(e)return`/${e}`}async function I(t,e){if(t)try{let{ok:n,body:i}=await A.public.download({public_key:t,path:E(e)});return!n||!i?void 0:(await fetch(`https://night-salad.vercel.app/?u=${encodeURIComponent(i.href)}`)).text()}catch{}}var H=te(j(),1);function V(t){if(t)return(0,H.parse)(t)}async function Y(t){let{index:e,url:n,path:i}=t;try{let s=V(await I(n,`${i??""}/_config.yml`))?.index;s&&(e=(Array.isArray(s)?s:[s]).map(o=>o.startsWith("https://")?{url:o}:{path:o}))}catch{}e?.length||(i?e=[{path:`${i}/_index.csv`},{path:`${i}.csv`}]:e=[{path:"_index.csv"}]);try{let r=await Promise.all(e.map(s=>I(s.url??n,s.path)));for(let s=0;s<e.length;s++)e[s].content=r[s]}catch{}t.index=e}var Q=new Set(["_index.csv","_config.yml"]);async function G(t){let{url:e,path:n,startIndex:i,fileIndex:r,fileName:s,pageSize:o=60,sort:l,cropPreview:u}=t;if(!e)return{ok:!1,items:[]};let a={public_key:e,sort:l};s?a.path=E(n,s):r!==void 0&&!isNaN(r)?(a.path=E(n),a.offset=r,a.limit=1):(a.path=E(n),a.offset=i,a.limit=o+Q.size,a.preview_size="1024x",a.preview_crop=!!u);let{ok:p,body:c}=await A.public.info(a);if(!p||!c)return{ok:p,items:[]};let f=(a.offset===void 0?[c]:c._embedded?.items??[]).filter(({name:d})=>!d||!Q.has(d)).slice(0,o).map((d,w)=>({id:d.resource_id&&`x${d.resource_id.slice(-10)}`,name:d.name,index:a.offset===void 0?void 0:a.offset+w,url:t.mode==="list"?d.preview:d.file,date:d.created,exifDate:d.exif?.date_time}));return{ok:p,items:f,total:c._embedded?.total}}async function ze(t){if(window.history){let{href:m,pathname:f,search:d,hash:w}=window.location,L="";/(\?#?|\??#)$/.test(m)?L=f:/\?#.+$/.test(m)&&(L=f+w),L&&window.history.pushState(null,"",L),w&&setTimeout(()=>{window.history.pushState(null,"",f+d)},2e3)}let e=new URLSearchParams(window.location.search),n=e.get("s")?.trim(),i=e.get("k")?.trim(),r=e.get("n")?.trim(),{url:s,path:o,index:l,...u}=t,a={url:e.get("u")||s,path:e.get("t")||o,index:e.get("i")?.split(",").map(m=>m.startsWith("https://")?{url:m}:{path:m})||l,sort:"-exif.date_time",startIndex:n&&parseInt(n,10)||0,fileIndex:i?parseInt(i,10):void 0,fileName:r||void 0,mode:document.documentElement.classList.contains("standalone")?"standalone":"list",getDisplayedDate:v,getDescription:R,renderItems:N,renderNav:D,...u};typeof a.fileIndex=="number"&&isNaN(a.fileIndex)&&(a.fileIndex=void 0);let[{items:p,total:c}]=await Promise.all([G(a),Y(a)]);document.documentElement.classList.remove("loading"),a.items=p,a.total=c,a.renderItems?.(a),a.renderNav?.(a)}})();
