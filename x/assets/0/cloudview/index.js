"use strict";(()=>{function y(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function $(e,t=","){let n=[],i="",r=!1;for(let s of e){if(s===t&&!r){n.push(y(i)),i="";continue}s==='"'&&(r=!r),i+=s}return i&&n.push(y(i)),n}var P=null;function q(e){return!P&&e.index?.length&&(P=e.index.map(({content:t})=>{if(!t)return null;let n=t.split(/\r?\n/).map(r=>r.trim()).filter(r=>r!=="").slice(1);if(n.length===0)return null;let i={};for(let r of n){let[s,o,a]=$(r);s&&(i[s]={description:o,location:a})}return i}).filter(t=>t!==null)),P}function D({name:e},t){if(!e)return;let n=q(t);if(!n?.length)return;let i=e.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/).slice(0,2),r=i.join("_"),s=null,o=null;for(let a=0;a<n.length;a++){let f=n[a];if(f[r])return f[r].description;for(let d=i.length;d>0;d--){r=i.slice(0,d).join("_");for(let l of Object.keys(f)){let c=l.endsWith("*")?l.replace(/\*+$/,""):l;r.startsWith(c)&&(!o||o.length<l.length)&&(o=l,s=a)}}}if(s!==null&&o!==null)return n[s]?.[o]?.description}function U({name:e},t){if(!e)return;let i=e.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/)[0]?.match(/^(\d{4})[-_]?(\d\d)?[-_]?(\d\d)?$/);if(!(!i||i.length<2))return i.slice(1,t.dateFormat==="short"?3:4).filter(r=>r!==void 0).join("-")}function h(e){let t=new URLSearchParams(window.location.search),n=new URLSearchParams,i=t.get("u"),r=t.get("i"),s=t.get("t");i&&n.set("u",i),r&&n.set("i",r),s&&n.set("t",s);let o=n.toString();return o?o+(e??""):""}var O={title:{en:"Album",ru:"\u0410\u043B\u044C\u0431\u043E\u043C"},list_nav_first_page:{en:"First page",ru:"\u041D\u0430 \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_last_page:{en:"Last page",ru:"\u041D\u0430 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044E\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_prev_page:{en:"Previous page",ru:"\u041D\u0430 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_next_page:{en:"Next page",ru:"\u041D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_home:{en:"Home",ru:"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E"},standalone_nav_prev:{en:"Previous",ru:"\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0430\u044F"},standalone_nav_next:{en:"Next",ru:"\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F"},standalone_nav_quit:{en:"To the list",ru:"\u041A \u0441\u043F\u0438\u0441\u043A\u0443"},list_item_fullscreen:{en:"\u041D\u0430 \u0432\u0435\u0441\u044C \u044D\u043A\u0440\u0430\u043D",ru:"Full screen"}},J=new Set(["en","ru"]);function S(){let e=navigator.language.split("-")[0];return J.has(e)?e:"en"}function m(e){return O[e]?.[S()]??O[e]?.en??e}var x=null;function j(e){if(!(!e.items?.length||!e.container)&&(x||(x=e.container instanceof Element?e.container:document.querySelector(e.container)),!!x)){e.mode==="list"&&e.aspectRatio!==void 0&&x.style.setProperty("--aspect-ratio",String(e.aspectRatio));for(let t of e.items){let n=document.createElement("figure"),i=`https://night-salad.vercel.app/?u=${encodeURIComponent(t.url??"")}`,r=e.getDisplayedDate?.(t,e),s=e.getDescription?.(t,e),o=`?${h("&")}k=${encodeURIComponent(t.index??"")}&n=${encodeURIComponent(t.name??"")}`;t.id&&(n.id=t.id),t.name&&(n.dataset.name=t.name),n.innerHTML=`<picture class="loading"><span><img src="${i}" alt="${t.name??""}" height="300" loading="lazy"></span></picture><figcaption><span class="content">`+(!e.hideDate&&r?`<span class="date">${r}</span> `:"")+(s?`<span class="description">${s}</span> `:"")+'</span><span class="controls">'+(e.mode==="list"?`<a href="${o}" title="${m("list_item_fullscreen")}">\u231E\u231D</a>`:"")+"</span></figcaption>",x.appendChild(n),e.mode==="standalone"&&s&&e.items.length===1&&(document.title=`${s}${!e.hideDate&&r?`, ${r}`:""} / ${e.title??m("title")}`)}for(let t of x.querySelectorAll("img")){if(t.complete){t.closest("picture")?.classList.remove("loading");continue}t.addEventListener("load",()=>{t.closest("picture")?.classList.remove("loading")})}}}var g=null;function M(e,t){if(t===void 0||!g)return;let n=g.querySelector(`[data-key="${e}"]`);n&&(n.href=t)}function k(e,t,n){if(n===void 0)return;let i=n<1?`?${h()}`:`?${h("&")}${`${encodeURIComponent(t)}=${encodeURIComponent(n)}`}`;M(e,i)}function N(e){if(e.navContainer&&(g||(g=e.navContainer instanceof Element?e.navContainer:document.querySelector(e.navContainer)),!!g)){if(e.mode==="list"){g.innerHTML=`<a title="${m("list_nav_first_page")}" data-key="start">\u25C0\u25C0</a> <a title="${m("list_nav_prev_page")} [\u2190]" data-key="prev">\u25C0</a> `+(e.homePage?`<a href="${e.homePage}" title="${m("list_nav_home")}" data-key="quit">\u25C6</a> `:"")+`<a title="${m("list_nav_next_page")} [\u2192]" data-key="next">\u25B6</a> <a title="${m("list_nav_last_page")}" data-key="end">\u25B6\u25B6</a>`;let{startIndex:t,pageSize:n,total:i}=e;if(t!==void 0&&n&&i!==void 0){let r=(Math.ceil(i/n)-1)*n;k("start","s",t===0?void 0:0),k("prev","s",t===0?void 0:t-n),k("next","s",t<r?Math.min(t+n,r):void 0),k("end","s",t<r?r:void 0)}}if(e.mode==="standalone"){g.innerHTML=`<a title="${m("standalone_nav_prev")} [\u2190]" data-key="prev">\u25C0</a> <a title="${m("standalone_nav_quit")}" data-key="quit">\u2630</a> <a title="${m("standalone_nav_next")} [\u2192]" data-key="next">\u25B6</a>`;let{fileIndex:t,pageSize:n}=e;if(t!==void 0&&n){let i=Math.floor(t/n)*n;k("prev","k",t===0?void 0:t-1),k("next","k",t+1);let r=`?${i>0?`${h("&")}s=${i}`:h()}`,s=`#${e.items?.[0]?.id??""}`;M("quit",`${r}${s}`)}}}}function B(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function A(e){return typeof e=="string"&&/^(\w+:)?\/\//.test(e)}var K="https://0.cc";function Y({request:e,target:t,endpoint:n}){let i=e?.method,r=e?.url??e?.path;if(t&&/^[A-Z]+\s/.test(t)){let[p,u]=t.split(/\s+/);i||(i=p),r||(r=u)}let s,o=A(r);if(r&&o)s=new URL(r);else if(s=new URL(n,K),o=A(n),r){let p=s.pathname;p||(s.pathname=r),p.endsWith("/")&&(p=p.slice(0,-1)),r.startsWith("/")&&(r=r.slice(1)),s.pathname=p+"/"+r}let a=e?.query,f=e?.params;if(a)for(let[p,u]of Object.entries(a))u!=null&&s.searchParams.append(p,String(u));if(f)for(let[p,u]of Object.entries(f))u!=null&&(s.pathname=s.pathname.replace(new RegExp(`:${B(p)}\\b`,"g"),String(u)));let{href:d,pathname:l,search:c,hash:w}=s;return{method:i,url:o?d:l+c+w}}function Z(e){if(!e)return;let t={};for(let[n,i]of Object.entries(e))i!=null&&(t[n]=typeof i=="string"?i:JSON.stringify(i));return t}var X=class{handler;constructor(e){this.handler=e}send(e,t){if(!this.handler)throw new Error("Missing request handler");return this.handler(e,t)}use(e){this.handler=e}getEntry(e){let t={};for(let[n,i]of Object.entries(e))t[n]=r=>this.send(i,r);return t}getQueryEntry(e){let t={};for(let[n,i]of Object.entries(e))t[n]=r=>this.send(i,{query:r});return t}},ee="RequestError",te="Unspecified";function _(e,t){if(!(!e||typeof e!="object"||!(t in e)))return e[t]}var ne=class R extends Error{data;status;statusText;constructor(t){let n={status:_(t,"status"),statusText:_(t,"statusText"),message:_(t,"message"),name:_(t,"name"),data:_(t,"data")},i=[n.status,n.statusText].filter(Boolean).join(" ");super(n.message||i||te),this.name=n.name??ee,this.status=Number(n.status??0),this.statusText=String(n.statusText??""),this.data=n.data,Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,R)}},re="https://cloud-api.yandex.net/v1",ie=class extends ne{};function se(e={}){let t;return"transformInput"in e?t=e.transformInput:t=({target:n,request:i})=>{let{method:r,url:s}=Y({request:i,target:n,endpoint:e.endpoint??re});return[s,{method:r,headers:Z({Accept:"application/json","Content-Type":"application/json",Authorization:e.token?`OAuth ${e.token}`:void 0,...i?.headers,...e.headers}),body:i?.body?JSON.stringify(i?.body):void 0}]},new X(async(n,i)=>{let r=await fetch(...t({target:n,request:i})),{ok:s,status:o,statusText:a}=r;if(!s){let f={status:o,statusText:a};try{f.data=await r.json()}catch{}throw new ie(f)}return{ok:s,status:o,statusText:a,body:await r.json()}})}function V(e={}){let t=se(e);return{public:t.getQueryEntry({info:"GET /disk/public/resources",list:"GET /disk/resources/public",download:"GET /disk/public/resources/download",save:"POST /disk/public/resources/save-to-disk"}),storage:t.getQueryEntry({info:"GET /disk"}),...t.getQueryEntry({info:"GET /disk/resources",list:"GET /disk/resources/files",recent:"GET /disk/resources/last-uploaded",create:"PUT /disk/resources",copy:"POST /disk/resources/copy",move:"POST /disk/resources/move",remove:"DELETE /disk/resources",publish:"PUT /disk/resources/publish",unpublish:"PUT /disk/resources/unpublish",upload:"GET /disk/resources/upload",uploadFromURL:"POST /disk/resources/upload",download:"GET /disk/resources/download",operation:"GET /disk/operations"}),...t.getEntry({update:"PATCH /disk/resources"}),trash:t.getQueryEntry({clear:"DELETE /disk/trash/resources",restore:"PUT /disk/trash/resources/restore"})}}var I=V();function v(e,t){if(e)return`/${[...e.split("/"),t].filter(Boolean).join("/")}`;if(t)return`/${t}`}async function E(e,t){if(e)try{let{ok:n,body:i}=await I.public.download({public_key:e,path:v(t)});return!n||!i?void 0:(await fetch(`https://night-salad.vercel.app/?u=${encodeURIComponent(i.href)}`)).text()}catch{}}async function Q(e){let{index:t,url:n,path:i}=e;t?.length||(i?t=[{path:`${i}/_index.csv`},{path:`${i}.csv`}]:t=[{path:"_index.csv"}]);try{let r=await Promise.all(t.map(s=>E(s.url??n,s.path)));for(let s=0;s<t.length;s++)t[s].content=r[s]}catch{}e.index=t}var W=new Set(["_index.csv","_config.yml"]);async function G(e){let{url:t,path:n,startIndex:i,fileIndex:r,fileName:s,pageSize:o,sort:a,cropPreview:f}=e;if(!t)return{ok:!1,items:[]};let d={public_key:t,sort:a};s?d.path=v(n,s):r!==void 0&&!isNaN(r)?(d.path=v(n),d.offset=r,d.limit=1):(d.path=v(n),d.offset=i,d.limit=o+W.size,d.preview_size="1024x",d.preview_crop=!!f);let{ok:l,body:c}=await I.public.info(d);if(!l||!c)return{ok:l,items:[]};let p=(d.offset===void 0?[c]:c._embedded?.items??[]).filter(({name:u})=>!u||!W.has(u)).slice(0,o).map((u,b)=>({id:u.resource_id&&`x${u.resource_id.slice(-10)}`,name:u.name,index:d.offset===void 0?void 0:d.offset+b,url:e.mode==="list"?u.preview:u.file,date:u.created,exifDate:u.exif?.date_time}));return{ok:l,items:p,total:c._embedded?.total}}function z(e){return e.replace(/(\w)_(\w)/g,(t,n,i)=>`${n}${i.toUpperCase()}`)}var T={index:e=>(Array.isArray(e)?e:[e]).map(t=>t.startsWith("https://")?{url:t}:{path:t}),cropPreview:JSON.parse,hideDate:JSON.parse,aspectRatio:Number};function H(e){if(!e)return;let t=e.split(/\r?\n/).filter(s=>s.trim()!==""),n={},i="",r=null;for(let s of t){let[o,a]=$(s,":");if(i)if(o.startsWith("  "))if(o=o.trim(),o.startsWith("-"))o=o.replace(/^\-\s*/,""),r||(r=[]),r.push(o);else{r||(r={}),o=z(o),a=y(a?.trim()??"");let f=`${i}.${o}`;r[o]=f in T?T[f](a):a}else r?(n[i]=r,r=null):n[i]="";else o=z(o.replace(/^-\s*/,"")),a=a?.trim(),a?(a=y(a),n[o]=o in T?T[o](a):a):i=o}return i&&(n[i]=r??""),n}var oe=["index","title","aspectRatio","cropPreview","hideDate","sort"];async function F(e){let{url:t,path:n}=e;try{let i=await E(t,`${n??""}/_config.yml`),r=H(i);if(r)for(let s of oe)r[s]!==void 0&&(e[s]=r[s])}catch{}}async function Ye(e){if(window.history){let{href:p,pathname:u,search:b,hash:L}=window.location,C="";/(\?#?|\??#)$/.test(p)?C=u:/\?#.+$/.test(p)&&(C=u+L),C&&window.history.pushState(null,"",C),L&&setTimeout(()=>{window.history.pushState(null,"",u+b)},2e3)}let t=new URLSearchParams(window.location.search),n=t.get("s")?.trim(),i=t.get("k")?.trim(),r=t.get("n")?.trim(),{url:s,path:o,index:a,pageSize:f,...d}=e,l={url:t.get("u")||s,path:t.get("t")||o,index:t.get("i")?.split(",").map(p=>p.startsWith("https://")?{url:p}:{path:p})||a,sort:"-exif.date_time",pageSize:f??60,startIndex:n&&parseInt(n,10)||0,fileIndex:i?parseInt(i,10):void 0,fileName:r||void 0,mode:document.documentElement.classList.contains("standalone")?"standalone":"list",getDisplayedDate:U,getDescription:D,renderItems:j,renderNav:N,...d};document.documentElement.setAttribute("lang",S()),document.title=m("title"),typeof l.fileIndex=="number"&&isNaN(l.fileIndex)&&(l.fileIndex=void 0),await F(l),l.title&&(document.title=l.title);let[{items:c,total:w}]=await Promise.all([G(l),Q(l)]);document.documentElement.classList.remove("loading"),l.items=c,l.total=w,l.renderItems?.(l),l.renderNav?.(l)}})();
