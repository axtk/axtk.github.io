"use strict";(()=>{function U(t){let e=t.split(/\r?\n/).map(r=>r.trim()).filter(r=>r!=="");if(e.length===0)return null;let n={};for(let r of e){let i=r.indexOf(" ");if(i===-1)continue;let o=r.slice(0,i).replace(/[xÑ…]/g,"*"),a=r.slice(i).trim();o&&a&&(n[o]=a)}return n}var c=null;function C({name:t},e){if(!t||!e.indexContent||(c||(c=U(e.indexContent)),!c))return;let n=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/).slice(0,2),r=n.join("_");if(c[r])return c[r];let i=null;for(let o=n.length;o>0;o--){r=n.slice(0,o).join("_");for(let[a,d]of Object.entries(c)){if(a===r)return d;let l=a.endsWith("*")?a.replace(/\*+$/,""):a;r.startsWith(l)&&(!i||i.length<a.length)&&(i=a)}}if(i)return c[i]}function E({name:t},e){if(!t)return;let r=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/)[0]?.match(/^(\d{4})[-_]?(\d\d)?[-_]?(\d\d)?$/);if(!(!r||r.length<2))return r.slice(1,e.dateFormat==="short"?3:4).filter(i=>i!==void 0).join("-")}function m(t){let e=new URLSearchParams(window.location.search),n=new URLSearchParams,r=e.get("u"),i=e.get("i");r&&n.set("u",r),i&&n.set("i",i);let o=n.toString();return o?o+(t??""):""}var k=null;function T(t){if(!(!t.items?.length||!t.container)&&(k||(k=t.container instanceof Element?t.container:document.querySelector(t.container)),!!k)){for(let e of t.items){let n=document.createElement("figure"),r=`https://night-salad.vercel.app/?u=${encodeURIComponent(e.url??"")}`,i=t.getDisplayedDate?.(e,t),o=t.getDescription?.(e,t),a=`?${m("&")}k=${encodeURIComponent(e.index??"")}&n=${encodeURIComponent(e.name??"")}`;e.id&&(n.id=e.id),e.name&&(n.dataset.name=e.name),n.innerHTML=`<picture><img src="${r}" alt="${e.name??""}" height="300" loading="lazy"></picture><figcaption><span class="content">`+(i?`<span class="date">${i}</span> `:"")+(o?`<span class="description">${o}</span> `:"")+'</span><span class="controls">'+(t.mode==="list"?`<a href="${a}" title="\u041D\u0430 \u0432\u0435\u0441\u044C \u044D\u043A\u0440\u0430\u043D">\u231E\u231D</a>`:"")+"</span></figcaption>",k.appendChild(n)}for(let e of k.querySelectorAll("img")){if(e.complete){e.classList.add("complete");continue}e.addEventListener("load",()=>{e.classList.add("complete")})}}}var h=null;function v(t,e){if(e===void 0||!h)return;let n=h.querySelector(`[data-key="${t}"]`);n&&(n.href=e)}function g(t,e,n){if(n===void 0)return;let r=n<1?`?${m()}`:`?${m("&")}${`${encodeURIComponent(e)}=${encodeURIComponent(n)}`}`;v(t,r)}function $(t){if(t.navContainer&&(h||(h=t.navContainer instanceof Element?t.navContainer:document.querySelector(t.navContainer)),!!h)){if(t.mode==="list"){h.innerHTML='<a title="\u041D\u0430 \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="start">\u25C0\u25C0</a> <a title="\u041D\u0430 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2190]" data-key="prev">\u25C0</a> '+(t.homePage?`<a href="${t.homePage}" title="\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E" data-key="quit">\u25C6</a> `:"")+'<a title="\u041D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2192]" data-key="next">\u25B6</a> <a title="\u041D\u0430 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044E\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="end">\u25B6\u25B6</a>';let{startIndex:e,pageSize:n,total:r}=t;if(e!==void 0&&n&&r!==void 0){let i=(Math.ceil(r/n)-1)*n;g("start","s",e===0?void 0:0),g("prev","s",e===0?void 0:e-n),g("next","s",e<i?Math.min(e+n,i):void 0),g("end","s",e<i?i:void 0)}}if(t.mode==="standalone"){h.innerHTML='<a title="\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0430\u044F [\u2190]" data-key="prev">\u25C0</a> <a title="\u041A \u0441\u043F\u0438\u0441\u043A\u0443" data-key="quit">\u2630</a> <a title="\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F [\u2192]" data-key="next">\u25B6</a>';let{fileIndex:e,pageSize:n}=t;if(e!==void 0&&n){let r=Math.floor(e/n)*n;g("prev","k",e===0?void 0:e-1),g("next","k",e+1);let i=`?${r>0?`${m("&")}s=${r}`:m()}`,o=`#${t.items?.[0]?.id??""}`;v("quit",`${i}${o}`)}}}}function D(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function P(t){return typeof t=="string"&&/^(\w+:)?\/\//.test(t)}var O="https://0.cc";function j({request:t,target:e,endpoint:n}){let r=t?.method,i=t?.url??t?.path;if(e&&/^[A-Z]+\s/.test(e)){let[s,f]=e.split(/\s+/);r||(r=s),i||(i=f)}let o,a=P(i);if(i&&a)o=new URL(i);else if(o=new URL(n,O),a=P(n),i){let s=o.pathname;s||(o.pathname=i),s.endsWith("/")&&(s=s.slice(0,-1)),i.startsWith("/")&&(i=i.slice(1)),o.pathname=s+"/"+i}let d=t?.query,l=t?.params;if(d)for(let[s,f]of Object.entries(d))f!=null&&o.searchParams.append(s,String(f));if(l)for(let[s,f]of Object.entries(l))f!=null&&(o.pathname=o.pathname.replace(new RegExp(`:${D(s)}\\b`,"g"),String(f)));let{href:p,pathname:u,search:w,hash:y}=o;return{method:r,url:a?p:u+w+y}}function _(t){if(!t)return;let e={};for(let[n,r]of Object.entries(t))r!=null&&(e[n]=typeof r=="string"?r:JSON.stringify(r));return e}var N=class{handler;constructor(t){this.handler=t}send(t,e){if(!this.handler)throw new Error("Missing request handler");return this.handler(t,e)}use(t){this.handler=t}getEntry(t){let e={};for(let[n,r]of Object.entries(t))e[n]=i=>this.send(r,i);return e}getQueryEntry(t){let e={};for(let[n,r]of Object.entries(t))e[n]=i=>this.send(r,{query:i});return e}},V="RequestError",M="Unspecified";function x(t,e){if(!(!t||typeof t!="object"||!(e in t)))return t[e]}var G=class b extends Error{data;status;statusText;constructor(e){let n={status:x(e,"status"),statusText:x(e,"statusText"),message:x(e,"message"),name:x(e,"name"),data:x(e,"data")},r=[n.status,n.statusText].filter(Boolean).join(" ");super(n.message||r||M),this.name=n.name??V,this.status=Number(n.status??0),this.statusText=String(n.statusText??""),this.data=n.data,Object.setPrototypeOf(this,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b)}},A="https://cloud-api.yandex.net/v1",Q=class extends G{};function z(t={}){let e;return"transformInput"in t?e=t.transformInput:e=({target:n,request:r})=>{let{method:i,url:o}=j({request:r,target:n,endpoint:t.endpoint??A});return[o,{method:i,headers:_({Accept:"application/json","Content-Type":"application/json",Authorization:t.token?`OAuth ${t.token}`:void 0,...r?.headers,...t.headers}),body:r?.body?JSON.stringify(r?.body):void 0}]},new N(async(n,r)=>{let i=await fetch(...e({target:n,request:r})),{ok:o,status:a,statusText:d}=i;if(!o){let l={status:a,statusText:d};try{l.data=await i.json()}catch{}throw new Q(l)}return{ok:o,status:a,statusText:d,body:await i.json()}})}function S(t={}){let e=z(t);return{public:e.getQueryEntry({info:"GET /disk/public/resources",list:"GET /disk/resources/public",download:"GET /disk/public/resources/download",save:"POST /disk/public/resources/save-to-disk"}),storage:e.getQueryEntry({info:"GET /disk"}),...e.getQueryEntry({info:"GET /disk/resources",list:"GET /disk/resources/files",recent:"GET /disk/resources/last-uploaded",create:"PUT /disk/resources",copy:"POST /disk/resources/copy",move:"POST /disk/resources/move",remove:"DELETE /disk/resources",publish:"PUT /disk/resources/publish",unpublish:"PUT /disk/resources/unpublish",upload:"GET /disk/resources/upload",uploadFromURL:"POST /disk/resources/upload",download:"GET /disk/resources/download",operation:"GET /disk/operations"}),...e.getEntry({update:"PATCH /disk/resources"}),trash:e.getQueryEntry({clear:"DELETE /disk/trash/resources",restore:"PUT /disk/trash/resources/restore"})}}var I=S();async function L(t){let{indexPublicKey:e}=t;if(!e)return{ok:!0,content:null};try{let{ok:n,body:r}=await I.public.download({public_key:e});if(!n||!r)return{ok:n,content:null};let i=`https://night-salad.vercel.app/?u=${encodeURIComponent(r.href)}`;return{ok:!0,content:await(await fetch(i)).text()}}catch{return{ok:!1,content:null}}}async function R(t){let{startIndex:e,fileIndex:n,fileName:r,publicKey:i,pageSize:o,sort:a,cropPreview:d}=t;if(!i)return{ok:!1,items:[]};let l={public_key:i,sort:a};r?l.path=`/${r}`:n!==void 0&&!isNaN(n)?(l.offset=n,l.limit=1):(l.offset=e,l.limit=o,l.preview_size="1024x",l.preview_crop=!!d);let{ok:p,body:u}=await I.public.info(l);if(!p||!u)return{ok:p,items:[]};let y=(l.offset===void 0?[u]:u._embedded?.items??[]).map((s,f)=>({id:s.resource_id&&`x${s.resource_id.slice(-10)}`,name:s.name,index:l.offset===void 0?void 0:l.offset+f,url:t.mode==="list"?s.preview:s.file,date:s.created,exifDate:s.exif?.date_time}));return{ok:p,items:y,total:u._embedded?.total}}async function q(t){if(window.history){let{href:p,pathname:u,search:w,hash:y}=window.location,s="";/(\?#?|\??#)$/.test(p)?s=u:/\?#.+$/.test(p)&&(s=u+y),s&&window.history.pushState(null,"",s),y&&setTimeout(()=>{window.history.pushState(null,"",u+w)},2e3)}let e=new URLSearchParams(window.location.search),n=e.get("s")?.trim(),r=e.get("k")?.trim(),i=e.get("n")?.trim(),o={publicKey:e.get("u")||void 0,indexPublicKey:e.get("i")||void 0,pageSize:60,sort:"-exif.date_time",startIndex:n&&parseInt(n,10)||0,fileIndex:r?parseInt(r,10):void 0,fileName:i||void 0,mode:document.documentElement.classList.contains("standalone")?"standalone":"list",getDisplayedDate:E,getDescription:C,renderItems:T,renderNav:$,...t};typeof o.fileIndex=="number"&&isNaN(o.fileIndex)&&(o.fileIndex=void 0);let[{items:a,total:d},{content:l}]=await Promise.all([R(o),L(o)]);document.documentElement.classList.remove("loading"),o.items=a,o.total=d,o.indexContent=l,o.renderItems?.(o),o.renderNav?.(o)}q({container:"main",navContainer:"nav",sort:"-name",dateFormat:"short",homePage:"/"});})();
