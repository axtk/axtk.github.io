"use strict";(()=>{function g(t){return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function v(t,e=","){let n=[],r="",i=!1;for(let o of t){if(o===e&&!i){n.push(g(r)),r="";continue}o==='"'&&(i=!i),r+=o}return r&&n.push(g(r)),n}var P=null;function L(t){return!P&&t.index?.length&&(P=t.index.map(({content:e})=>{if(!e)return null;let n=e.split(/\r?\n/).map(i=>i.trim()).filter(i=>i!=="").slice(1);if(n.length===0)return null;let r={};for(let i of n){let[o,s,a]=v(i);o&&(r[o]={description:s,location:a})}return r}).filter(e=>e!==null)),P}function _({name:t},e){if(!t)return;let n=L(e);if(!n?.length)return;let r=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/).slice(0,2),i=r.join("_"),o=null,s=null;for(let a=0;a<n.length;a++){let p=n[a];if(p[i])return p[i].description;for(let f=r.length;f>0;f--){i=r.slice(0,f).join("_");for(let l of Object.keys(p)){let m=l.endsWith("*")?l.replace(/\*+$/,""):l;i.startsWith(m)&&(!s||s.length<l.length)&&(s=l,o=a)}}}if(o!==null&&s!==null)return n[o]?.[s]?.description}function D({name:t},e){if(!t)return;let r=t.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/)[0]?.match(/^(\d{4})[-_]?(\d\d)?[-_]?(\d\d)?$/);if(!(!r||r.length<2))return r.slice(1,e.dateFormat==="short"?3:4).filter(i=>i!==void 0).join("-")}function c(t){let e=new URLSearchParams(window.location.search),n=new URLSearchParams,r=e.get("u"),i=e.get("i"),o=e.get("t");r&&n.set("u",r),i&&n.set("i",i),o&&n.set("t",o);let s=n.toString();return s?s+(t??""):""}var y=null;function U(t){if(!(!t.items?.length||!t.container)&&(y||(y=t.container instanceof Element?t.container:document.querySelector(t.container)),!!y)){t.mode==="list"&&t.aspectRatio!==void 0&&y.style.setProperty("--aspect-ratio",String(t.aspectRatio));for(let e of t.items){let n=document.createElement("figure"),r=`https://night-salad.vercel.app/?u=${encodeURIComponent(e.url??"")}`,i=t.getDisplayedDate?.(e,t),o=t.getDescription?.(e,t),s=`?${c("&")}k=${encodeURIComponent(e.index??"")}&n=${encodeURIComponent(e.name??"")}`;e.id&&(n.id=e.id),e.name&&(n.dataset.name=e.name),n.innerHTML=`<picture><span><img src="${r}" alt="${e.name??""}" height="300" loading="lazy"></span></picture><figcaption><span class="content">`+(!t.hideDate&&i?`<span class="date">${i}</span> `:"")+(o?`<span class="description">${o}</span> `:"")+'</span><span class="controls">'+(t.mode==="list"?`<a href="${s}" title="\u041D\u0430 \u0432\u0435\u0441\u044C \u044D\u043A\u0440\u0430\u043D">\u231E\u231D</a>`:"")+"</span></figcaption>",y.appendChild(n)}for(let e of y.querySelectorAll("img")){if(e.complete){e.classList.add("complete");continue}e.addEventListener("load",()=>{e.classList.add("complete")})}}}var h=null;function q(t,e){if(e===void 0||!h)return;let n=h.querySelector(`[data-key="${t}"]`);n&&(n.href=e)}function x(t,e,n){if(n===void 0)return;let r=n<1?`?${c()}`:`?${c("&")}${`${encodeURIComponent(e)}=${encodeURIComponent(n)}`}`;q(t,r)}function O(t){if(t.navContainer&&(h||(h=t.navContainer instanceof Element?t.navContainer:document.querySelector(t.navContainer)),!!h)){if(t.mode==="list"){h.innerHTML='<a title="\u041D\u0430 \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="start">\u25C0\u25C0</a> <a title="\u041D\u0430 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2190]" data-key="prev">\u25C0</a> '+(t.homePage?`<a href="${t.homePage}" title="\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E" data-key="quit">\u25C6</a> `:"")+'<a title="\u041D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 [\u2192]" data-key="next">\u25B6</a> <a title="\u041D\u0430 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044E\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443" data-key="end">\u25B6\u25B6</a>';let{startIndex:e,pageSize:n,total:r}=t;if(e!==void 0&&n&&r!==void 0){let i=(Math.ceil(r/n)-1)*n;x("start","s",e===0?void 0:0),x("prev","s",e===0?void 0:e-n),x("next","s",e<i?Math.min(e+n,i):void 0),x("end","s",e<i?i:void 0)}}if(t.mode==="standalone"){h.innerHTML='<a title="\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0430\u044F [\u2190]" data-key="prev">\u25C0</a> <a title="\u041A \u0441\u043F\u0438\u0441\u043A\u0443" data-key="quit">\u2630</a> <a title="\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F [\u2192]" data-key="next">\u25B6</a>';let{fileIndex:e,pageSize:n}=t;if(e!==void 0&&n){let r=Math.floor(e/n)*n;x("prev","k",e===0?void 0:e-1),x("next","k",e+1);let i=`?${r>0?`${c("&")}s=${r}`:c()}`,o=`#${t.items?.[0]?.id??""}`;q("quit",`${i}${o}`)}}}}function H(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function M(t){return typeof t=="string"&&/^(\w+:)?\/\//.test(t)}var F="https://0.cc";function J({request:t,target:e,endpoint:n}){let r=t?.method,i=t?.url??t?.path;if(e&&/^[A-Z]+\s/.test(e)){let[u,d]=e.split(/\s+/);r||(r=u),i||(i=d)}let o,s=M(i);if(i&&s)o=new URL(i);else if(o=new URL(n,F),s=M(n),i){let u=o.pathname;u||(o.pathname=i),u.endsWith("/")&&(u=u.slice(0,-1)),i.startsWith("/")&&(i=i.slice(1)),o.pathname=u+"/"+i}let a=t?.query,p=t?.params;if(a)for(let[u,d]of Object.entries(a))d!=null&&o.searchParams.append(u,String(d));if(p)for(let[u,d]of Object.entries(p))d!=null&&(o.pathname=o.pathname.replace(new RegExp(`:${H(u)}\\b`,"g"),String(d)));let{href:f,pathname:l,search:m,hash:C}=o;return{method:r,url:s?f:l+m+C}}function B(t){if(!t)return;let e={};for(let[n,r]of Object.entries(t))r!=null&&(e[n]=typeof r=="string"?r:JSON.stringify(r));return e}var K=class{handler;constructor(t){this.handler=t}send(t,e){if(!this.handler)throw new Error("Missing request handler");return this.handler(t,e)}use(t){this.handler=t}getEntry(t){let e={};for(let[n,r]of Object.entries(t))e[n]=i=>this.send(r,i);return e}getQueryEntry(t){let e={};for(let[n,r]of Object.entries(t))e[n]=i=>this.send(r,{query:i});return e}},Y="RequestError",Z="Unspecified";function w(t,e){if(!(!t||typeof t!="object"||!(e in t)))return t[e]}var X=class S extends Error{data;status;statusText;constructor(e){let n={status:w(e,"status"),statusText:w(e,"statusText"),message:w(e,"message"),name:w(e,"name"),data:w(e,"data")},r=[n.status,n.statusText].filter(Boolean).join(" ");super(n.message||r||Z),this.name=n.name??Y,this.status=Number(n.status??0),this.statusText=String(n.statusText??""),this.data=n.data,Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S)}},ee="https://cloud-api.yandex.net/v1",te=class extends X{};function ne(t={}){let e;return"transformInput"in t?e=t.transformInput:e=({target:n,request:r})=>{let{method:i,url:o}=J({request:r,target:n,endpoint:t.endpoint??ee});return[o,{method:i,headers:B({Accept:"application/json","Content-Type":"application/json",Authorization:t.token?`OAuth ${t.token}`:void 0,...r?.headers,...t.headers}),body:r?.body?JSON.stringify(r?.body):void 0}]},new K(async(n,r)=>{let i=await fetch(...e({target:n,request:r})),{ok:o,status:s,statusText:a}=i;if(!o){let p={status:s,statusText:a};try{p.data=await i.json()}catch{}throw new te(p)}return{ok:o,status:s,statusText:a,body:await i.json()}})}function j(t={}){let e=ne(t);return{public:e.getQueryEntry({info:"GET /disk/public/resources",list:"GET /disk/resources/public",download:"GET /disk/public/resources/download",save:"POST /disk/public/resources/save-to-disk"}),storage:e.getQueryEntry({info:"GET /disk"}),...e.getQueryEntry({info:"GET /disk/resources",list:"GET /disk/resources/files",recent:"GET /disk/resources/last-uploaded",create:"PUT /disk/resources",copy:"POST /disk/resources/copy",move:"POST /disk/resources/move",remove:"DELETE /disk/resources",publish:"PUT /disk/resources/publish",unpublish:"PUT /disk/resources/unpublish",upload:"GET /disk/resources/upload",uploadFromURL:"POST /disk/resources/upload",download:"GET /disk/resources/download",operation:"GET /disk/operations"}),...e.getEntry({update:"PATCH /disk/resources"}),trash:e.getQueryEntry({clear:"DELETE /disk/trash/resources",restore:"PUT /disk/trash/resources/restore"})}}var E=j();function k(t,e){if(t)return`/${[...t.split("/"),e].filter(Boolean).join("/")}`;if(e)return`/${e}`}async function T(t,e){if(t)try{let{ok:n,body:r}=await E.public.download({public_key:t,path:k(e)});return!n||!r?void 0:(await fetch(`https://night-salad.vercel.app/?u=${encodeURIComponent(r.href)}`)).text()}catch{}}async function N(t){let{index:e,url:n,path:r}=t;e?.length||(r?e=[{path:`${r}/_index.csv`},{path:`${r}.csv`}]:e=[{path:"_index.csv"}]);try{let i=await Promise.all(e.map(o=>T(o.url??n,o.path)));for(let o=0;o<e.length;o++)e[o].content=i[o]}catch{}t.index=e}var Q=new Set(["_index.csv","_config.yml"]);async function V(t){let{url:e,path:n,startIndex:r,fileIndex:i,fileName:o,pageSize:s,sort:a,cropPreview:p}=t;if(!e)return{ok:!1,items:[]};let f={public_key:e,sort:a};o?f.path=k(n,o):i!==void 0&&!isNaN(i)?(f.path=k(n),f.offset=i,f.limit=1):(f.path=k(n),f.offset=r,f.limit=s+Q.size,f.preview_size="1024x",f.preview_crop=!!p);let{ok:l,body:m}=await E.public.info(f);if(!l||!m)return{ok:l,items:[]};let u=(f.offset===void 0?[m]:m._embedded?.items??[]).filter(({name:d})=>!d||!Q.has(d)).slice(0,s).map((d,b)=>({id:d.resource_id&&`x${d.resource_id.slice(-10)}`,name:d.name,index:f.offset===void 0?void 0:f.offset+b,url:t.mode==="list"?d.preview:d.file,date:d.created,exifDate:d.exif?.date_time}));return{ok:l,items:u,total:m._embedded?.total}}function W(t){return t.replace(/(\w)_(\w)/g,(e,n,r)=>`${n}${r.toUpperCase()}`)}var $={index:t=>(Array.isArray(t)?t:[t]).map(e=>e.startsWith("https://")?{url:e}:{path:e}),cropPreview:JSON.parse,hideDate:JSON.parse,aspectRatio:Number};function A(t){if(!t)return;let e=t.split(/\r?\n/).filter(o=>o.trim()!==""),n={},r="",i=null;for(let o of e){let[s,a]=v(o,":");if(r)if(s.startsWith("  "))if(s=s.trim(),s.startsWith("-"))s=s.replace(/^\-\s*/,""),i||(i=[]),i.push(s);else{i||(i={}),s=W(s),a=g(a?.trim()??"");let p=`${r}.${s}`;i[s]=p in $?$[p](a):a}else i?(n[r]=i,i=null):n[r]="";else s=W(s.replace(/^-\s*/,"")),a=a?.trim(),a?(a=g(a),n[s]=s in $?$[s](a):a):r=s}return r&&(n[r]=i??""),n}var re=["index","title","aspectRatio","cropPreview","hideDate","sort"];async function G(t){let{url:e,path:n}=t;try{let r=await T(e,`${n??""}/_config.yml`),i=A(r);if(i)for(let o of re)i[o]!==void 0&&(t[o]=i[o])}catch{}}async function z(t){if(window.history){let{href:u,pathname:d,search:b,hash:R}=window.location,I="";/(\?#?|\??#)$/.test(u)?I=d:/\?#.+$/.test(u)&&(I=d+R),I&&window.history.pushState(null,"",I),R&&setTimeout(()=>{window.history.pushState(null,"",d+b)},2e3)}let e=new URLSearchParams(window.location.search),n=e.get("s")?.trim(),r=e.get("k")?.trim(),i=e.get("n")?.trim(),{url:o,path:s,index:a,pageSize:p,...f}=t,l={url:e.get("u")||o,path:e.get("t")||s,index:e.get("i")?.split(",").map(u=>u.startsWith("https://")?{url:u}:{path:u})||a,sort:"-exif.date_time",pageSize:p??60,startIndex:n&&parseInt(n,10)||0,fileIndex:r?parseInt(r,10):void 0,fileName:i||void 0,mode:document.documentElement.classList.contains("standalone")?"standalone":"list",getDisplayedDate:D,getDescription:_,renderItems:U,renderNav:O,...f};typeof l.fileIndex=="number"&&isNaN(l.fileIndex)&&(l.fileIndex=void 0),await G(l);let[{items:m,total:C}]=await Promise.all([V(l),N(l)]);document.documentElement.classList.remove("loading"),l.items=m,l.total=C,l.renderItems?.(l),l.renderNav?.(l)}z({container:"main",navContainer:"nav",url:"https://disk.yandex.ru/d/m7msMoTw8t0MvQ",path:"0",sort:"-name",dateFormat:"short",homePage:"/"});})();
