"use strict";(()=>{var S={config:"https://raw.githubusercontent.com/axtk/translit/refs/heads/main/configs/ru.json",chars:"https://raw.githubusercontent.com/axtk/axtk.github.io/refs/heads/main/x/assets/translit/chars.json"};var J=new Set(["\u0301"]);function b(e){let n={},t=Object.entries(e);for(let r=t.length-1;r>=0;r--){let[l,o]=t[r];if(l.length===1)n[l]={...o,character:l};else{let s=l.split(""),p=s[0],i={...o,character:`${J.has(p)?"\u25CC":""}${p}`};for(let c of s)n[c]=i}}return n}async function v(){let[e,n]=await Promise.all([S.config,S.chars].map(t=>fetch(t).then(r=>r.json())));return{config:e,chars:b(n)}}function H({q:e}){document.querySelector('.input [name="q"]').value=e}function k(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var V=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"]];function h(e){let n=String(e);if(!e)return"";for(let[t,r]of V)n=n.replace(new RegExp(k(t),"g"),r);return n}function I(e,n){if(n===void 0||n>=e.length)return e;let t=new Set,r=[];for(;r.length<n;){let l=e[Math.floor(e.length*Math.random())],o=JSON.stringify(l);t.has(o)||(r.push(l),t.add(o))}return r}var Y=3;function q(e,n){return e===void 0||n===void 0?e??"":e.replace(new RegExp(k(n),"g"),t=>`<span class="mark">${h(t)}</span>`)}var O={ru:"\u043F\u043E-\u0440\u0443\u0441\u0441\u043A\u0438",cz:"\u043F\u043E-\u0447\u0435\u0448\u0441\u043A\u0438",sk:"\u043F\u043E-\u0441\u043B\u043E\u0432\u0430\u0446\u043A\u0438",sl:"\u043F\u043E-\u0441\u043B\u043E\u0432\u0435\u043D\u0441\u043A\u0438",pl:"\u043F\u043E-\u043F\u043E\u043B\u044C\u0441\u043A\u0438",sr:"\u043F\u043E-\u0441\u0435\u0440\u0431\u0441\u043A\u0438"};function _(e,n){let t=new Set(Object.keys(n.chars)),r=new Set;for(let l of e.toLowerCase())t.has(l)&&r.add(l);return Array.from(r)}function B({entries:e,mark:n}){let t=e[0],r=e.slice(1),l=null,o=null,s=document.createElement("td");if(t){let[p,i,c]=t.split("|");l=document.createElement("div"),l.className="entry-content",c&&(l.innerHTML+=`<span class="secondary">${h(c)}</span>&nbsp;\u2192 `),l.innerHTML+=`<strong>${q(i,n)}</strong> <span class="lang">${h(O[p]??p)}</span>`,s.appendChild(l)}if(r?.length){o=document.createElement("div"),o.className="entry-content";for(let p=0;p<r.length;p++){let[i,c,g]=r[p].split("|");o.innerHTML+=(p===0?"":'<span class="sep">, </span>')+`<span><strong class="primary">${q(c,n)}</strong> `+(g?`<span class="secondary">(${h(g)})</span> `:"")+`<span class="lang">${h(O[i]??i)}</span></span>`}s.appendChild(o)}return s}function U(e,n){let t=document.querySelector(".chars"),r=_(e,n);if(t.toggleAttribute("hidden",r.length===0),r.length===0)return;let l=t.querySelector("table");l.innerHTML="";for(let o of r){let{examples:s,character:p}=n.chars[o];s=I(s.filter(c=>c.at(-1)!=="-"),Y);let i=document.createElement("tbody");for(let c=0;c<s.length;c++){let g=s[c],f=document.createElement("tr");if(c===0){let a=document.createElement("th");a.rowSpan=s.length,a.textContent=p,f.appendChild(a)}let m=B({entries:g,mark:p});m.innerHTML&&(f.appendChild(m),i.appendChild(f))}l.appendChild(i)}}function Q(e){return e!==null&&typeof e=="object"&&"value"in e&&Array.isArray(e.value)}function j(e,{def:n={}}={}){let t,r;e.length>2&&e.includes(" ")?[r,...t]=e.split(" "):t=[e];for(let l=0;l<t.length;l++)if(t[l].startsWith("#")){let o=t[l].slice(1);o in n&&t.splice(l,1,...n[o])}return{value:t,op:r}}function N(e,n){let t;if(Array.isArray(e)){t=[];for(let r of e)Q(r)?t.push(r):Array.isArray(r)?t.push({value:r}):t.push(j(r,n))}else t=[j(e,n)];if(!n.strictCase)for(let r of t)r.value=r.value.map(l=>l.toLowerCase());return t}function X(e,n){return{key:e.key,from:N("from"in e?e.from:e.key,n),to:N(e.to,n)}}function Z(e){return Array.isArray(e)&&Array.isArray(e[0])}function ee(e){let{map:n=[]}=e;return(Z(n)?n:[n]).map(r=>r.map(l=>X(l,e)))}function P(e,n={}){if(typeof e!="string")throw new Error("Input should be a string");let t=e.split(""),r=t.slice(),l=new Array(t.length).fill(!1),o=new Array(t.length).fill(!1),s=new Array(t.length).fill(!1),p=ee(n);for(let c of p){let{ignore:g=[]}=n,f=a=>a&&!n.strictCase?a.toLowerCase():a,m=g.map(f);for(let a=0;a<t.length;a++){let x=f(t[a]);if(m.includes(x))continue;let K=t[a].toLowerCase(),A=t[a].toUpperCase();l[a]=A!==K&&t[a]===A;for(let{key:F,from:E,to:L}of c){if(x!==F||s[a])continue;let R=E.findIndex(u=>u.value.length===1&&u.value[0]===x);if(R===-1)continue;let d=[],y=a;for(;d.length<R+1;){let u=f(t[y]);m.includes(u)||d.push([u,y]),y--}for(d.reverse(),y=a+1;d.length<E.length;){let u=f(t[y]);m.includes(u)||d.push([u,y]),y++}let M=d.length!==0;for(let u=0;u<d.length&&M;u++){let[C]=d[u],w=E[u];if(!w){M=!1;break}let{value:W,op:T}=w,$=C!==void 0&&W.includes(C);M&&=(T==="NOT"?!$:$)&&(T!=="OTHER"||x!==C)}if(M)for(let u=0;u<E.length;u++){let C=d[u][1],w=L[u].value[0];w!==void 0&&w!=="~"&&(r[C]=w,o[C]=w.length===1||L[u].op==="GLYPH",s[C]=!0)}}}if(c.length!==0)for(let a=0;a<r.length;a++)!s[a]||!l[a]||!r[a]||(o[a]||l[a-1]&&l[a+1]||l[a-2]&&l[a-1]||l[a+1]&&l[a+2]?r[a]=r[a].toUpperCase():r[a]=r[a][0].toUpperCase()+r[a].slice(1))}let i=r.join("");return{input:e,inputGlyphs:t,output:i,outputGlyphs:r,isUpperCase:l}}var G="\u0301";function D(e,n){let{inputGlyphs:t,outputGlyphs:r}=P(e,n),l="",o="",s="";for(let i=0;i<r.length;i++){let c=t[i],g=t[i+1],f=r[i];if(c!==G)if(g===G){let m=h(l),a=h(f);o+=`${m}<u>${a}</u>`,s+=`${m.toUpperCase()}<u>${a.toUpperCase()}</u>`,l=""}else l+=f}if(l){let i=h(l);o+=i,s+=i.toUpperCase()}let p=e.replaceAll(G,"");return{output:o,uppercaseOutput:s,unstressedInput:p}}function z(e){let{q:n,config:t}=e,r=document.title.split("/").at(-1)?.trim()??"";if(!n){document.documentElement.dataset.output="none",document.title=r;return}let l=document.querySelector(".output"),{output:o,uppercaseOutput:s,unstressedInput:p}=D(n,t);l.querySelector(".result strong").innerHTML=o;let i=l.querySelector(".result .uppercased");i.innerHTML=s,i.toggleAttribute("hidden",o===s),l.querySelector("a.unstress").href=`?q=${encodeURIComponent(p)}`,document.documentElement.dataset.output=n===p?"unstressed":"stressed",document.title=`${n} \u043B\u0430\u0442\u0438\u043D\u0438\u0446\u0435\u0439 / ${r}`,U(o,e)}async function te(){window.history&&window.location.href.endsWith("?")&&window.history.pushState(null,"",window.location.pathname);let n={...await v(),q:new URLSearchParams(window.location.search).get("q")?.trim()??""};H(n),z(n)}te();})();
