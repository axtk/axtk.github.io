"use strict";(()=>{var y=class{state;callbacks=new Set;revision=-1;constructor(e){this.state=e}onUpdate(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}getState(){return this.state}setState(e){let n=this.state,o=e instanceof Function?e(this.state):e;this.state=o,this.revision=Math.random();for(let t of this.callbacks)t(o,n)}};function x({store:e}){let{moves:n,lastMoveIndex:o,winLength:t,rows:l,columns:r}=e.getState();if(o<=t)return{value:"playing"};let s=n.slice(0,o+1),f=s.filter((c,i)=>i%2===o%2),a=l*r,u;for(let c of f)for(let i=0;i<4;i++){let S=i===0?1:r+i-2,g=0,m=c-(t-1)*S,H=Math.min(a,c+(t-1)*S);for(;m<H&&g<t;){m>=0&&(f.includes(m)?g++:g=0);let d=Math.floor(m/r),h=m-d*r;m+=S;let v=Math.floor(m/r),b=m-v*r;if(i===0&&v!==d||i===1&&(v!==d+1||b!==h-1)||i===2&&b!==h||i===3&&(v!==d+1||b!==h+1))break}if(g===t){u=[];for(let d=0;d<t;d++)u.push(m-(d+1)*S);return{value:"win",win:u}}}return s.length===a?{value:"draw"}:{value:"playing"}}var w=null;function C(e){let{container:n,store:o}=e,t=n.querySelector(".board"),l=Array.from(t.querySelectorAll("button")),r=x(e),s=o.getState();t.toggleAttribute("disabled",r.value!=="playing"),t.setAttribute("style",`--rows: ${s.rows}; --columns: ${s.columns};`);let f=s.rows*s.columns;for(l.length===0&&(t.innerHTML="");l.length<f;){let a=document.createElement("button");t.append(a),l.push(a)}for(;l.length>f;)l.pop().remove();w===null&&(w=a=>{let u=a.target,c=u instanceof HTMLButtonElement?l.indexOf(u):-1;c!==-1&&o.setState(i=>({...i,moves:[...i.moves.slice(0,i.lastMoveIndex+1),c],lastMoveIndex:i.lastMoveIndex+1}))},t.addEventListener("click",w));for(let a=0;a<l.length;a++){let u=l[a],c=s.moves.lastIndexOf(a,s.lastMoveIndex);u.toggleAttribute("disabled",c!==-1),u.classList.toggle("selected",!!r.win?.includes(a)),u.textContent=c===-1?"":s.cellValues[c%2]}}function M(e){document.documentElement.dataset.status=x(e).value}var I=!1;function k(e){if(I)return;let n=e.container.querySelector(".game-controls");n.querySelector(".undo").addEventListener("click",()=>{e.store.setState(o=>({...o,lastMoveIndex:o.lastMoveIndex-1}))}),n.querySelector(".clear").addEventListener("click",()=>{e.store.setState(o=>({...o,moves:[],lastMoveIndex:-1}))}),I=!0}function L(e,n=0){return e?[...e][n]:""}function E(){let e=new URLSearchParams(window.location.search);return{moves:[],lastMoveIndex:-1,cellValues:[L(e.get("x"),0)||"\u274C",L(e.get("o"),0)||"\u2B55"],rows:Number(e.get("rows"))||3,columns:Number(e.get("columns"))||3,winLength:Number(e.get("win"))||3}}function p(e,n){let o=String(n),t=e.querySelectorAll("option"),l=!1;for(let r of t)r.value===o||r.textContent===o?(r.setAttribute("selected","selected"),l=!0):r.removeAttribute("selected");if(!l){let r=document.createElement("option");r.textContent=o,r.setAttribute("selected","selected"),e.prepend(r)}}var A=!1;function q(e){if(A)return;let n=e.store.getState(),o=e.container.querySelector(".controlbar form"),t=l=>o.querySelector(`select[name="${l}"]`);p(t("x"),n.cellValues[0]),p(t("o"),n.cellValues[1]),p(t("rows"),n.rows),p(t("columns"),n.columns),p(t("win"),n.winLength),A=!0}function V(e){C(e),M(e),k(e),q(e)}function U(){let e={container:document.querySelector("#app"),store:new y(E())};V(e),e.store.onUpdate(()=>{V(e)})}U();})();
