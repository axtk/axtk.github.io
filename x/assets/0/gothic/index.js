"use strict";(()=>{function M({q:e,eg:t,ge:o}){let n=document.querySelector("form.input"),r=n.querySelector('[name="q"]');r.value=e,n.querySelector('[name="eg"]').checked=t,n.querySelector('[name="ge"]').checked=o,e||r.focus()}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var H=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"]];function v(e){let t=String(e);if(!e)return"";for(let[o,n]of H)t=t.replace(new RegExp(p(o),"g"),n);return t}var y="https://raw.githubusercontent.com/axtk/gothic/refs/heads/main",f={abbrs:`${y}/abbreviations.processed.json`,ge:`${y}/gothic-english.processed.json`,eg:`${y}/english-gothic.processed.json`};async function T(e){let[t,o,n]=await Promise.all([e.data.abbrs?null:f.abbrs,e.data.ge||!e.ge?null:f.ge,e.data.eg||!e.eg?null:f.eg].map(r=>r&&fetch(r).then(l=>l.json())));t&&(e.data.abbrs=t),o&&(e.data.ge=o),n&&(e.data.eg=n)}function E(e,{data:{abbrs:t}}){if(!t||!(e in t))return`<abbr>${e}</abbr>`;let{d:o,t:n,g:r,s:l}=t[e],i=n??e,s=r?` data-group="${r}"`:"";switch(l){case"i":return`<i>${i}</i>`;case"regular":return i;default:return`<abbr title="${o}"${s}>${i}</abbr>`}}function I(e,t,o){let n=e.term,r=e.def;if(n=n.replace(/\{\{(&\w+)\}\}/g,"$1;"),r=r.replace(/\{\{(&\w+)\}\}/g,"$1;"),o.data.abbrs){let g=Object.keys(o.data.abbrs);for(let m of g){let u=new RegExp(p(`{{${m}}}`),"g"),c=E(m,o);n=n.replace(u,c),r=r.replace(u,c)}}r=r.replace(/(<deriv>)/g,'$1<strong class="title">Derivations:</strong> '),r=r.replace(/(<comp>)/g,'$1<strong class="title">Compounds:</strong> '),r=r.replace(/<(note|def|ex(-t|-sep)?|term|d|intro|deriv|comp)>/g,'<span class="$1">'),r=r.replace(/<\/(note|def|ex(-t|-sep)?|term|d|intro|deriv|comp)>/g,"</span>"),r=r.replace(/<(ex-s|spec|v)>/g,'<i class="$1">'),r=r.replace(/<\/(ex-s|spec|v)>/g,"</i>");let{value:l,captureIndex:i}=t.expressions[e.expressionIndex],s,a;return i>1?(s=new RegExp(l,"gi"),a=`$${i-1}<mark>$${i}</mark>$${i+1}`):(s=new RegExp(`(${l})`,"gi"),a="<mark>$1</mark>"),n=n.replace(s,a),r=r.replace(s,a),n=n.replace(/&<\/mark>(#?\w+;)/g,"&$1</mark>"),r=r.replace(/&<\/mark>(#?\w+;)/g,"&$1</mark>"),e.htmlTerm=n,e.htmlDef=r,e}var L={"\u{10330}":"a","\u{10331}":"b","\u{10332}":"g","\u{10333}":"d","\u{10334}":"e","\u{10335}":"q","\u{10336}":"z","\u{10337}":"h","\u{10338}":"\xFE","\u{10339}":"i","\u{1033A}":"k","\u{1033B}":"l","\u{1033C}":"m","\u{1033D}":"n","\u{1033E}":"j","\u{1033F}":"u","\u{10340}":"p","\u{10342}":"r","\u{10343}":"s","\u{10344}":"t","\u{10345}":"w","\u{10346}":"f","\u{10347}":"x","\u{10348}":"\u0195","\u{10349}":"\u014D"};function S(e){let t=e;for(let[o,n]of Object.entries(L))t.includes(o)&&(t=t.replace(new RegExp(p(o),"g"),n));return t}function $(e){return e?e.toLowerCase().replace(/\s+/g," ").trim().replace(/þ/gi,"th").replace(/á/gi,"a").replace(/é/gi,"e").replace(/í/gi,"i").replace(/ó/gi,"o").replace(/ú/gi,"u"):""}function D({relevance:e=0},{relevance:t=0}){return e===t?0:e>t?-1:1}async function q(e){let t=$(S(e.q));if(!t)return;await T(e);let o={expressions:[{value:`\\b${p(t)}\\b`,captureIndex:1},{value:p(t),captureIndex:1}],entries:[]};t.length<4&&(o.expressions=[{value:`(^|\\pP|\\b)(${p(t)})(\\pP|\\b|$)`,captureIndex:2}]);let{expressions:n}=o,r=n.length,l={eg:e.data.eg,ge:e.data.ge};for(let[i,s]of Object.entries(l))if(s)for(let a of s){let g=$(a.t),m=$(a.d),u=!1;for(let c=0;c<r&&!u;c++){let{value:w}=n[c],C=new RegExp(w,"g").test(g),R=new RegExp(w,"g");if(u=C||R.test(m),!u)continue;let d={dictionaryKey:i,expressionIndex:c,term:a.t,def:a.dx},h=20*(r-c-1);if(C)if(g===t)d.relevance=h+20;else{let x=t.length,b=g.length;d.relevance=h+10+10*(x<b?x/b:b/x)}else m.length!==0&&(d.relevance=h+10*(1-R.lastIndex/m.length));o.entries.push(I(d,o,e))}}return o.entries.sort(D),o}async function k(e){let{q:t}=e,o=document.title.split("/").at(-1)?.trim()??"",n=document.querySelector(".output"),r=document.querySelector("h1");if(n.toggleAttribute("hidden",!t),!t){document.title=o,r.innerHTML=r.textContent;return}document.title=`${v(t)} / ${o}`,r.innerHTML=`<a href="?">${r.textContent}</a>`;let l=n.querySelector(".content");l.textContent="Loading...",n.dataset.status="loading";let i=(await q(e))?.entries;if(!i?.length){let a="No relevant entries found.";t.includes(" ")?a+="<br> Try to search one word at a time.":!e.eg&&!e.ge?a+="<br> Try to search with at least one dictionary enabled.":(!e.eg||!e.ge)&&(a+="<br> Try to search with both dictionaries enabled."),l.innerHTML=a,n.dataset.status="warning";return}let s="";for(let{htmlTerm:a,htmlDef:g}of i)s+=`<dt>${a}</dt>
<dd>${g}</dd>
`;l.innerHTML=`<dl>${s}</dl>`,n.dataset.status="loaded"}async function j(){let e=new URLSearchParams(window.location.search),t={eg:e.get("eg"),ge:e.get("ge")},o={q:e.get("q")?.trim()??"",eg:t.eg==="1"||t.eg===null&&t.ge===null,ge:t.ge==="1"||t.eg===null&&t.ge===null,data:{}};if(window.history){let n="";window.location.href.endsWith("?")?n=window.location.pathname:o.q&&t.eg==="1"&&t.ge==="1"&&(e.delete("eg"),e.delete("ge"),n=`?${e.toString()}`),n&&window.history.pushState(null,"",n)}M(o),await k(o)}j();})();
