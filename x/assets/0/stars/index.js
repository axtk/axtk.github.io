"use strict";(()=>{var q="https://raw.githubusercontent.com/axtk/axtk.github.io/refs/heads/main/x/assets/stars/data",F={stars:`${q}/stars_m6.csv`,constellationLabels:`${q}/constellation_labels.csv`,constellationNames:`${q}/constellation_names.csv`,constellationLines:`${q}/constellation_lines.csv`},d="http://www.w3.org/2000/svg",X={alp:"\u03B1",bet:"\u03B2",gam:"\u03B3",del:"\u03B4",eps:"\u03B5",zet:"\u03B6",eta:"\u03B7",the:"\u03B8",iot:"\u03B9",kap:"\u03BA",lam:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omi:"\u03BF",pi:"\u03C0",rho:"\u03C1",sig:"\u03C3",tau:"\u03C4",ups:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",ome:"\u03C9",omg:"\u03C9"},V=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"],Q={O:"#c0ffff",B:"#c0ffff",A:"#ffffff",F:"#ffffff",G:"#f9f9d8",K:"#ffe0c0",M:"#f9cdcd"};function v(e){let r=e?.match(/^([^\d]+)(\d+)?$/);if(!r)return e;let[,n="",t=""]=r;return X[n]&&(n=X[n]),t&&(t=V[Number(t)]??t),`${n}${t}`}var K=class{ra;dec;magnitude;id;spectralClass;bayerKey;constellation;properName;constructor({ra:r,dec:n,magnitude:t,id:o,spectralClass:s,bayerName:i,properName:a}){this.ra=r,this.dec=n,this.magnitude=t,this.id=o,this.spectralClass=s,this.properName=a,i&&([this.bayerKey,this.constellation]=i.split(" "),this.bayerKey=v(this.bayerKey))}get bayerName(){if(this.bayerKey!==void 0)return this.constellation===void 0?this.bayerKey:`${this.bayerKey} ${this.constellation}`}get name(){let{bayerName:r}=this;if(r!==void 0)return this.properName?`${this.properName}, ${r}`:r}};function k(e){return!e||!e.startsWith('"')||!e.endsWith('"')?e:e.slice(1,-1)}function W(e){return e.trim().split(/\r?\n/).slice(1).map(r=>{let[n,t,o,s,i,a,l]=r.split(",");return new K({ra:Number(n),dec:Number(t),magnitude:Number(o),id:s,spectralClass:i,bayerName:k(a),properName:k(l)})})}var R=class{ra;dec;name;constructor({ra:r,dec:n,name:t}){this.ra=r,this.dec=n,this.name=t}};function j(e){return e.trim().split(/\r?\n/).slice(1).map(r=>{let[n,t,o]=r.split(",");return new R({ra:Number(t),dec:Number(o),name:n})})}function Ne(e){let r={};for(let n of e){let t=n.bayerName||`#${n.id}`;r[t]=[n.ra,n.dec]}return r}function J(e,r){let n=Ne(r);return e.trim().split(/\r?\n/).map(t=>{let o=t.split(","),s=[],i=o[0],a=o[1].slice(1,-1).split(" ");for(let l of a){let m=null;if(l.includes("=")&&(m=n[`#${l.split("=").at(-1)}`]),m){s.push(m);continue}if(l.includes("_")){let u=l.indexOf("_");m=n[`${v(l.slice(0,u))} ${l.slice(u+1)}`]}else m=n[`${v(l)} ${i}`];m&&s.push(m)}return s})}function U(e){return e.trim().split(/\r?\n/).slice(1).reduce((r,n)=>{let[t,o]=n.split(",").map(k);return t&&o&&(r[t]=o),r},{})}async function Fe(e){return fetch(e).then(r=>r.text())}async function Z(){let[e,r,n,t]=await Promise.all([F.stars,F.constellationLabels,F.constellationNames,F.constellationLines].map(Fe)),o=W(e),s=j(r),i=J(t,o),a=U(n);return{stars:o,constellationLabels:s,constellationNames:a,constellationLines:i}}var z=null,ee="";function h({element:e}){let r=e.getAttribute("data-size");if(r===ee&&z!==null)return z;let n=Number(e.getAttribute("width")),t=Number(e.getAttribute("height"));return z={width:n,height:t,r:Math.sqrt(n*n+t*t)/1.65,x0:n/2,y0:t/2},ee=r,z}function B(){document.querySelector("#screenmenu")?.classList.add("hidden")}var te=!1;function ne(e){if(e.mode!=="dark"||te)return;let r=e.element.parentElement,n=r.querySelector("defs"),t=n?.querySelector("#spcl")?.outerHTML;if(!n||!t)return;let o=document.createElement("style"),s="",i="";for(let[a,l]of Object.entries(Q)){let m=`html[data-mode="dark"] #screen .stars circle[data-spcl^="${a}"]`;s+=`${m}{fill:url(#spcl_${a});}`,i+=`
${t}`.replace('id="spcl"',`id="spcl_${a}"`).replaceAll("currentColor",l)}n.innerHTML+=i,o.innerHTML=s,r.prepend(o),te=!0}var{sin:A,cos:S}=Math;function c(e,r,n,t=.25){let{tilt:[o,s]}=n,{width:i,height:a,x0:l,y0:m,r:u}=h(n),f=u*S(r)*S(e),p=u*A(r),b=u*S(r)*A(e),M=f*S(o)+b*A(o),x=p,E=-f*A(o)+b*S(o),g=M,y=x*S(s)-E*A(s),T=x*A(s)+E*S(s);return g=l+g,y=m-y,T<0||g<-t*i||g>(1+t)*i||y<-t*a||y>(1+t)*a?null:[g,y,T]}var{PI:C}=Math,I=C/100,D=C/12,re=C/50;function oe(e){let r=e.element.querySelector("g.grid"),n=r.querySelector("path");n||(n=document.createElementNS(d,"path"),r.appendChild(n));let t,o="",s="";for(let i=-C/2+D;i<=C/2-D+I;i+=D){let a="",l=!1;for(let m=0;m<=2*C+I;m+=re){if(t=c(m,i,e,.5),s=a&&!l?" L":"M",t===null){l=!0;continue}l&&(l=!1),a+=`${s}${t[0].toFixed(3)},${t[1].toFixed(3)}`}o+=`${o?" ":""}${a}`}for(let i=0;i<=2*C-D+I;i+=D){let a="",l=!1;for(let m=-C/2;m<=C/2+I;m+=re){if(t=c(i,m,e,.5),s=a&&!l?" L":"M",t===null){l=!0;continue}l&&(l=!1),a+=`${s}${t[0].toFixed(3)},${t[1].toFixed(3)}`}o+=`${o?" ":""}${a}`}n.setAttribute("d",o)}function _(e,r){return r.mode==="fantasy"?2*(6.75-e.magnitude):r.mode==="light"?.6*(6.75-e.magnitude):.7*(6.75-e.magnitude)}function ie(e){let r=e.element.querySelector("g.stars"),n=Array.from(r.querySelectorAll("circle")),t=null,o,s,i,a=0;for(let l=0;l<e.stars.length;l++)o=e.stars[l],i=c(o.ra,o.dec,e),i!==null&&(s=n[a++],s||(t||(t=document.createDocumentFragment()),s=document.createElementNS(d,"circle"),t.appendChild(s)),s.setAttribute("cx",i[0].toFixed(3)),s.setAttribute("cy",i[1].toFixed(3)),s.setAttribute("r",_(o,e).toFixed(3)),s.setAttribute("data-spcl",o.spectralClass??""));t&&r.appendChild(t);for(let l=a;l<n.length;l++)n[l].remove()}function le(e){let{r}=h(e),n=r<640?3:4,t=e.element.querySelector("g.star-labels"),o=Array.from(t.querySelectorAll("text")),s=null,i,a,l,m=0;for(let u=0;u<e.stars.length;u++){if(i=e.stars[u],!i.bayerKey||i.magnitude>n||(l=c(i.ra,i.dec,e),l===null))continue;a=o[m++],a||(s||(s=document.createDocumentFragment()),a=document.createElementNS(d,"text"),s.appendChild(a));let f=_(i,e);a.setAttribute("x",(l[0]+f+2).toFixed(3)),a.setAttribute("y",(l[1]+2).toFixed(3)),a.textContent=i.bayerKey}s&&t.appendChild(s);for(let u=m;u<o.length;u++)o[u].remove()}var{floor:ce,random:N,sin:se,cos:ae,PI:me}=Math;function ve(){return`#${["","",""].map(()=>ce(50+120*N()).toString(16)).join("")}`}var ue=30,fe=!1,ke='html[data-mode="fantasy"] #screen .stars circle';function de(e){if(e.mode!=="fantasy"||fe)return;let r=e.element.parentElement,n=r.querySelector("defs");if(!n)return;let t=document.createDocumentFragment(),o="";for(let i=0;i<ue;i++){let a="",l=Array.from({length:2}).map(()=>ve());for(let u=0;u<2;u++)for(let f=.25*u;f<5;f++){let p=2*me*N(),b=5+f*ae(p),M=5+f*se(p),x=p+me*(.5+.5*N()),E=5+f*ae(x),g=5+f*se(x),y=l[ce(N()*l.length)];a+=`<path d="M${b} ${M} A ${f} ${f} 0 1 0 ${E} ${g}" stroke="${y}" fill="none" stroke-width="${(.75+N()).toFixed(3)}" stroke-opacity="${(.35+.55*N()).toFixed(3)}"/>`}let m=document.createElementNS(d,"pattern");m.setAttribute("id",`s_${i}`),m.setAttribute("viewBox","0 0 10 10"),m.setAttribute("width","100%"),m.setAttribute("height","100%"),m.innerHTML=a,t.append(m),o+=`${ke}:nth-child(${ue}n+${i}){fill:url(#s_${i});}`}let s=document.createElement("style");s.innerHTML=o,r.append(s),n.append(t),fe=!0}function De(e,r){if(e.name)return r.constellationNames[e.name]??e.name}function pe(e){let r=e.element.querySelector("g.constellation-labels"),n=Array.from(r.querySelectorAll("text")),t=null,o,s,i,a,l=0;for(let m=0;m<e.constellationLabels.length;m++)o=e.constellationLabels[m],s=De(o,e),s&&(a=c(o.ra,o.dec,e),a!==null&&(i=n[l++],i||(t||(t=document.createDocumentFragment()),i=document.createElementNS(d,"text"),t.appendChild(i)),i.setAttribute("x",a[0].toFixed(3)),i.setAttribute("y",a[1].toFixed(3)),i.textContent=s));t&&r.appendChild(t);for(let m=l;m<n.length;m++)n[m].remove()}function he(e){let r=e.element.querySelector("g.constellation-lines"),n=Array.from(r.querySelectorAll("path")),t=null,o,s,i,a,l=0;for(let m=0;m<e.constellationLines.length;m++){o=e.constellationLines[m],s="";for(let u of o)a=c(u[0],u[1],e,1),a!==null&&(s+=`${s?" L":"M"}${a[0]},${a[1]}`);s&&(i=n[l++],i||(t||(t=document.createDocumentFragment()),i=document.createElementNS(d,"path"),t.appendChild(i)),i.setAttribute("d",s))}t&&r.appendChild(t);for(let m=l;m<n.length;m++)n[m].remove()}function $(e){oe(e),ne(e),ie(e),le(e),de(e),pe(e),he(e)}var be="stars.",L={read(e){try{let r=localStorage.getItem(`${be}${e}`);return r===null?null:JSON.parse(r)}catch{return null}},write(e,r){try{localStorage.setItem(`${be}${e}`,JSON.stringify(r))}catch{}}};function P(e,r=0,n=2*Math.PI,t){for(;e<r;)e+=n-r;if(t)for(;e>n;)e-=n-r;else for(;e>=n;)e-=n-r;return e}var{PI:ge,asin:ye}=Math,w=!1;function Ce(e,r,n){let{tilt:t}=e,{r:o}=h(e),s=ye(r/o),i=ye(n/o),a=t[0]+s,l=t[1]+i;t[0]=P(a),l>=-ge/2&&l<=ge/2&&(t[1]=l),w||(requestAnimationFrame(()=>{$(e),L.write("tilt",t),w=!1}),w=!0)}function Pe(e){let{element:r}=e,n=null,t=null;r.addEventListener("mousedown",o=>{n=o.offsetX,t=o.offsetY,w=!1}),r.addEventListener("mouseup",()=>{n=null,t=null,w=!1}),r.addEventListener("mousemove",o=>{n!==null&&t!==null&&(Ce(e,o.offsetX-n,o.offsetY-t),n=o.offsetX,t=o.offsetY)})}function Te(e){let{element:r}=e,n=null,t=null;r.addEventListener("touchstart",o=>{n=o.changedTouches[0].pageX,t=o.changedTouches[0].pageY,w=!1,B()}),r.addEventListener("touchend",()=>{n=null,t=null,w=!1}),r.addEventListener("touchmove",o=>{n!==null&&t!==null&&(Ce(e,o.changedTouches[0].pageX-n,o.changedTouches[0].pageY-t),n=o.changedTouches[0].pageX,t=o.changedTouches[0].pageY)})}function xe(e){Pe(e),Te(e)}var{sin:H,cos:G,asin:qe,atan2:Ke,sqrt:Re,PI:Se}=Math;function $e(e,r,n){let{tilt:[t,o]}=n,{r:s,x0:i,y0:a}=h(n),l=e-i,m=a-r,u=s*s-l*l-m*m;if(u<0)return null;let f=Re(u),p=l,b=m*G(-o)-f*H(-o),M=m*H(-o)+f*G(-o),x=p*G(-t)+M*H(-t),E=b,g=-p*H(-t)+M*G(-t),y=P(Ke(g,x)),T=P(qe(E/s),-Se/2,Se/2,!0);return[y,T]}var Y=240;function Le(e,r,n,t){let{width:o,height:s}=h(t),i=document.querySelector("#screenmenu");if(i||(i=document.createElement("div"),i.id="screenmenu",t.element.parentElement?.appendChild(i)),n.length===0){i.classList.add("hidden");return}let a=document.createElement("ul");for(let p of n){let b=document.createElement("li");b.textContent=p.name??`#${p.id}`,a.appendChild(b)}i.innerHTML="",i.style.width="",i.appendChild(a),i.classList.remove("hidden");let{width:l,height:m}=i.getBoundingClientRect();l>Y?(i.style.width=`${Y}px`,i.classList.add("wide"),l=Y):i.classList.remove("wide");let u=Math.min(e+4,o-l-6),f=Math.min(r+4,s-m-6);i.style.setProperty("--x",`${u}px`),i.style.setProperty("--y",`${f}px`)}var{abs:we}=Math,Me=5;function ze(e,r){return e.magnitude-r.magnitude}function Ee(e){document.addEventListener("click",r=>{if(!e.element.contains(r.target))return;let{left:n,top:t}=e.element.getBoundingClientRect(),o=r.offsetX-n,s=r.offsetY-t,i=$e(o,s,e);if(console.log("click",i),i===null)return;let a=[];for(let l of e.stars){let m=c(l.ra,l.dec,e);m!==null&&we(m[0]-o)<=Me&&we(m[1]-s)<=Me&&a.push(l)}a.sort(ze);for(let l of a)console.log(`#${l.id}; ${l.name}`,l.magnitude),window.sendEvent?.(["click star",l.name??`#${l.id}`]);Le(o,s,a,e)})}function Ae(e){let r=document.querySelector("#screen form");for(let n of r.querySelectorAll('[name="mode"]'))n.checked=n.value===e.mode;r.addEventListener("change",n=>{let t=n.target;if(t instanceof HTMLInputElement&&t.name==="mode"){let o=t.value;document.documentElement.dataset.mode=o,e.mode=o,$(e),L.write("mode",o),window.sendEvent?.(["set mode",o])}})}function O({element:e}){let r=e.parentElement;if(!r)return;e.setAttribute("style","display: none");let{width:n,height:t}=r.getBoundingClientRect();e.setAttribute("width",String(n)),e.setAttribute("height",String(t)),e.setAttribute("viewBox",`0 0 ${n} ${t}`),e.setAttribute("data-size",Math.random().toString(36).slice(2)),e.removeAttribute("style")}async function Be(){let e=document.querySelector("#screen svg"),r=await Z(),n=L.read("mode")??document.documentElement.dataset.mode,t={...r,element:e,tilt:L.read("tilt")??[-.12,0],mode:n};document.documentElement.dataset.mode!==n&&(document.documentElement.dataset.mode=n);let o=null;window.addEventListener("resize",()=>{o!==null&&cancelAnimationFrame(o),o=requestAnimationFrame(()=>{B(),O(t),$(t)})}),O(t),Ae(t),$(t),xe(t),Ee(t),window.sendEvent?.(["load mode",n])}Be();})();
