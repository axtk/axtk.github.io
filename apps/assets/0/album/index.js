"use strict";(()=>{function x(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function $(e,t=","){let n=[],r="",i=!1;for(let o of e){if(o===t&&!i){n.push(x(r)),r="";continue}o==='"'&&(i=!i),r+=o}return r&&n.push(x(r)),n}var b=null;function M(e){return!b&&e.index?.length&&(b=e.index.map(({content:t})=>{if(!t)return null;let n=t.split(/\r?\n/).map(i=>i.trim()).filter(i=>i!=="").slice(1);if(n.length===0)return null;let r={};for(let i of n){let[o,s,a]=$(i);o&&(r[o]={description:s,location:a})}return r}).filter(t=>t!==null)),b}function D({name:e},t){if(!e)return;let n=M(t);if(!n?.length)return;let r=e.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/).slice(0,2),i=r.join("_"),o=null,s=null;for(let a=0;a<n.length;a++){let f=n[a];if(f[i])return f[i].description;for(let d=r.length;d>0;d--){i=r.slice(0,d).join("_");for(let m of Object.keys(f)){let h=m.endsWith("*")?m.replace(/\*+$/,""):m;i.startsWith(h)&&(!s||s.length<m.length)&&(s=m,o=a)}}}if(o!==null&&s!==null)return n[o]?.[s]?.description}function O({name:e},t){if(!e)return;let r=e.replace(/(^[^\d]+_|\.\w+$)/g,"").split(/[-_]/)[0]?.match(/^(\d{4})[-_]?(\d\d)?[-_]?(\d\d)?$/);if(!(!r||r.length<2))return r.slice(1,t.dateFormat==="short"?3:4).filter(i=>i!==void 0).join("-")}var ee="RequestError",te="Unspecified";function E(e,t){if(!(!e||typeof e!="object"||!(t in e)))return e[t]}var ne=class P extends Error{data;status;statusText;constructor(t){let n={status:E(t,"status"),statusText:E(t,"statusText"),message:E(t,"message"),name:E(t,"name"),data:E(t,"data")},r=[n.status,n.statusText].filter(Boolean).join(" ");super(n.message||r||te),this.name=n.name??ee,this.status=Number(n.status??0),this.statusText=String(n.statusText??""),this.data=n.data,Object.setPrototypeOf(this,P.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,P)}},re=class{handler;constructor(e){this.handler=e}send(e,t){if(!this.handler)throw new Error("Missing request handler");return this.handler(e,t)}use(e){this.handler=e}getEntry(e){let t={};for(let[n,r]of Object.entries(e))t[n]=i=>this.send(r,i);return t}getQueryEntry(e){let t={};for(let[n,r]of Object.entries(e))t[n]=i=>this.send(r,{query:i});return t}};function ie(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function A(e){return typeof e=="string"&&/^(\w+:)?\/\//.test(e)}var oe="https://0.cc";function se({request:e,target:t,endpoint:n}){let r=e?.method,i=e?.url??e?.path;if(t&&/^[A-Z]+\s/.test(t)){let[p,l]=t.split(/\s+/);r||(r=p),i||(i=l)}let o,s=A(i);if(i&&s)o=new URL(i);else if(o=new URL(n,oe),s=A(n),i){let p=o.pathname;p||(o.pathname=i),p.endsWith("/")&&(p=p.slice(0,-1)),i.startsWith("/")&&(i=i.slice(1)),o.pathname=`${p}/${i}`}let a=e?.query,f=e?.params;if(a)for(let[p,l]of Object.entries(a))l!=null&&o.searchParams.append(p,String(l));if(f)for(let[p,l]of Object.entries(f))l!=null&&(o.pathname=o.pathname.replace(new RegExp(`:${ie(p)}\\b`,"g"),String(l)));let{href:d,pathname:m,search:h,hash:u}=o;return{method:r,url:s?d:m+h+u}}function ae(e){if(!e)return;let t={};for(let[n,r]of Object.entries(e))r!=null&&(t[n]=typeof r=="string"?r:JSON.stringify(r));return t}var le="https://cloud-api.yandex.net/v1",de=class extends ne{};function ue(e={}){let t;return"transformInput"in e?t=e.transformInput:t=({target:n,request:r})=>{let{method:i,url:o}=se({request:r,target:n,endpoint:e.endpoint??le});return[o,{method:i,headers:ae({Accept:"application/json","Content-Type":"application/json",Authorization:e.token?`OAuth ${e.token}`:void 0,...r?.headers,...e.headers}),body:r?.body?JSON.stringify(r?.body):void 0}]},new re(async(n,r)=>{let i=await fetch(...t({target:n,request:r})),{ok:o,status:s,statusText:a}=i;if(!o){let f={status:s,statusText:a};try{f.data=await i.json()}catch{}throw new de(f)}return{ok:o,status:s,statusText:a,body:await i.json()}})}function N(e={}){let t=ue(e);return{public:t.getQueryEntry({info:"GET /disk/public/resources",list:"GET /disk/resources/public",download:"GET /disk/public/resources/download",save:"POST /disk/public/resources/save-to-disk"}),storage:t.getQueryEntry({info:"GET /disk"}),...t.getQueryEntry({info:"GET /disk/resources",list:"GET /disk/resources/files",recent:"GET /disk/resources/last-uploaded",create:"PUT /disk/resources",copy:"POST /disk/resources/copy",move:"POST /disk/resources/move",remove:"DELETE /disk/resources",publish:"PUT /disk/resources/publish",unpublish:"PUT /disk/resources/unpublish",upload:"GET /disk/resources/upload",uploadFromURL:"POST /disk/resources/upload",download:"GET /disk/resources/download",operation:"GET /disk/operations"}),...t.getEntry({update:"PATCH /disk/resources"}),trash:t.getQueryEntry({clear:"DELETE /disk/trash/resources",restore:"PUT /disk/trash/resources/restore"})}}var C=N(),I="https://axtk.me/ydimg";var fe=["url","path","tag","index"];function g(e){let t=new URLSearchParams(window.location.search),n=new URLSearchParams;for(let i of fe){let o=t.get(i);o&&n.set(i,o)}let r=n.toString();return r?r+(e??""):""}var j={title:{en:"Album",ru:"\u0410\u043B\u044C\u0431\u043E\u043C"},list_nav_first_page:{en:"First page",ru:"\u041D\u0430 \u043F\u0435\u0440\u0432\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_last_page:{en:"Last page",ru:"\u041D\u0430 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044E\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_prev_page:{en:"Previous page",ru:"\u041D\u0430 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_next_page:{en:"Next page",ru:"\u041D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"},list_nav_home:{en:"Home",ru:"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E"},standalone_nav_prev:{en:"Previous",ru:"\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0430\u044F"},standalone_nav_next:{en:"Next",ru:"\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F"},standalone_nav_quit:{en:"To the list",ru:"\u041A \u0441\u043F\u0438\u0441\u043A\u0443"},list_item_fullscreen:{en:"\u041D\u0430 \u0432\u0435\u0441\u044C \u044D\u043A\u0440\u0430\u043D",ru:"Full screen"}},pe=new Set(["en","ru"]);function S(){let e=navigator.language.split("-")[0];return pe.has(e)?e:"en"}function c(e){return j[e]?.[S()]??j[e]?.en??e}function me(e){return`${I}/${e.name}?u=${encodeURIComponent(e.url??"")}`}async function q(e){e.closest("picture")?.classList.remove("loading")}var w=null;function H(e){if(!(!e.items?.length||!e.container)&&(w||(w=e.container instanceof Element?e.container:document.querySelector(e.container)),!!w)){e.mode==="list"&&e.aspectRatio!==void 0&&w.style.setProperty("--aspect-ratio",String(e.aspectRatio));for(let t of e.items){let n=document.createElement("figure"),r=e.getDisplayedDate?.(t,e),i=e.getDescription?.(t,e),o=`?${g("&")}k=${encodeURIComponent(t.index??"")}&name=${encodeURIComponent(t.name??"")}`;t.id&&(n.id=t.id),t.name&&(n.dataset.name=t.name),n.innerHTML=`<picture class="loading"><span><img src="${me(t)}" alt="${t.name??""}" height="300" loading="lazy"></span></picture><figcaption><span class="content">`+(!e.hideDate&&r?`<span class="date">${r}</span> `:"")+(i?`<span class="description">${i}</span> `:"")+'</span><span class="controls">'+(e.mode==="list"?`<a href="${o}" title="${c("list_item_fullscreen")}">\u231E\u231D</a>`:"")+"</span></figcaption>",w.appendChild(n),e.mode==="standalone"&&i&&e.items.length===1&&(document.title=`${i}${!e.hideDate&&r?`, ${r}`:""} / ${e.title??c("title")}`)}for(let t of w.querySelectorAll("img"))t.complete?q(t):t.addEventListener("load",()=>q(t))}}var y=null;function V(e,t){if(t===void 0||!y)return;let n=y.querySelector(`[data-key="${e}"]`);n&&(n.href=t)}function v(e,t,n){if(n===void 0)return;let r=n<1?`?${g()}`:`?${g("&")}${`${encodeURIComponent(t)}=${encodeURIComponent(n)}`}`;V(e,r)}function Q(e){if(e.navContainer&&(y||(y=e.navContainer instanceof Element?e.navContainer:document.querySelector(e.navContainer)),!!y)){if(e.mode==="list"){y.innerHTML=`<a title="${c("list_nav_first_page")}" data-key="start">\u25C0\u25C0</a> <a title="${c("list_nav_prev_page")} [\u2190]" data-key="prev">\u25C0</a> `+(e.homePage?`<a href="${e.homePage}" title="${c("list_nav_home")}" data-key="quit">\u25C6</a> `:"")+`<a title="${c("list_nav_next_page")} [\u2192]" data-key="next">\u25B6</a> <a title="${c("list_nav_last_page")}" data-key="end">\u25B6\u25B6</a>`;let{startIndex:t,pageSize:n,total:r}=e;if(t!==void 0&&n&&r!==void 0){let i=(Math.ceil(r/n)-1)*n;v("start","start",t===0?void 0:0),v("prev","start",t===0?void 0:t-n),v("next","start",t<i?Math.min(t+n,i):void 0),v("end","start",t<i?i:void 0)}}if(e.mode==="standalone"){y.innerHTML=`<a title="${c("standalone_nav_prev")} [\u2190]" data-key="prev">\u25C0</a> <a title="${c("standalone_nav_quit")}" data-key="quit">\u2630</a> <a title="${c("standalone_nav_next")} [\u2192]" data-key="next">\u25B6</a>`;let{fileIndex:t,pageSize:n}=e;if(t!==void 0&&n){let r=Math.floor(t/n)*n;v("prev","k",t===0?void 0:t-1),v("next","k",t+1);let i=`?${r>0?`${g("&")}start=${r}`:g()}`,o=`#${e.items?.[0]?.id??""}`;V("quit",`${i}${o}`)}}}}function ce(e){return e.reduce((t,n,r)=>(t[String(r)]=n,t),{})}function U(e,t){if(Array.isArray(e)){for(let n of e){let r=U(n,t);if(r)return r}return null}if(e instanceof RegExp){let n=String(t).match(e);if(n)return{...ce(Array.from(n).slice(1)),...n.groups}}return e==="*"||e===t?{}:null}function he(){return Math.random().toString(36).slice(2)}var G=class{_listeners;constructor(){this._listeners=[]}on(e,t){return this._addListener(e,t)}once(e,t){return this._addListener(e,t,!0)}addListener(e,t){return this._addListener(e,t)}_addListener(e,t,n=!1){if(typeof t!="function")throw new Error("handler is not a function");let r=he();return this._listeners.push({id:r,type:e,handler:t,once:n}),{remove:()=>this._removeListener(r)}}_removeListener(e){for(let t=this._listeners.length-1;t>=0;t--)this._listeners[t].id===e&&this._listeners.splice(t,1)}emit(e,t){let n={type:e,data:t};for(let r of this._listeners)this.matches(r,n)&&(r.once&&this._removeListener(r.id),r.handler(this.toHandlerPayload(r,n)))}matches(e,t){return U(e.type,t.type)!==null}toHandlerPayload(e,t){let n=U(e.type,t.type);return{...t,params:n}}};var R=new G;function _(e,t){if(e)return`/${[...e.split("/"),t].filter(Boolean).join("/")}`;if(t)return`/${t}`}async function L(e,t){if(e)try{let{ok:n,body:r}=await C.public.download({public_key:e,path:_(t)});return!n||!r?void 0:(await fetch(`${I}?u=${encodeURIComponent(r.href)}`)).text()}catch{}}async function W(e){let{index:t,url:n,path:r}=e;t?.length||(r?t=[{path:`${r}/_index.csv`},{path:`${r}.csv`}]:t=[{path:"_index.csv"}]);try{let i=await Promise.all(t.map(o=>L(o.url??n,o.path)));for(let o=0;o<t.length;o++)t[o].content=i[o]}catch{}e.index=t}var z=new Set(["_index.csv","_config.yml"]);async function F(e){let{url:t,path:n,startIndex:r,fileIndex:i,fileName:o,pageSize:s,sort:a,cropPreview:f}=e;if(!t)return{ok:!1,items:[]};let d={public_key:t,sort:a};o?d.path=_(n,o):i!==void 0&&!Number.isNaN(i)?(d.path=_(n),d.offset=i,d.limit=1):(d.path=_(n),d.offset=r,d.limit=s+z.size,d.preview_size="1024x",d.preview_crop=!!f);let{ok:m,body:h}=await C.public.info(d);if(!m||!h)return{ok:m,items:[]};let p=(d.offset===void 0?[h]:h._embedded?.items??[]).filter(({name:l})=>!l||!z.has(l)).slice(0,s).map((l,k)=>({id:l.resource_id&&`x${l.resource_id.slice(-10)}`,key:l.public_key,path:l.path,name:l.name,index:d.offset===void 0?void 0:d.offset+k,url:e.mode==="list"?l.preview:l.file,date:l.created,exifDate:l.exif?.date_time}));return{ok:m,items:p,total:h._embedded?.total}}function B(e){return e.replace(/(\w)_(\w)/g,(t,n,r)=>`${n}${r.toUpperCase()}`)}var T={index:e=>(Array.isArray(e)?e:[e]).map(t=>t.startsWith("https://")?{url:t}:{path:t}),cropPreview:JSON.parse,hideDate:JSON.parse,aspectRatio:Number};function J(e){if(!e)return;let t=e.split(/\r?\n/).filter(o=>o.trim()!==""),n={},r="",i=null;for(let o of t){let[s,a]=$(o,":");if(r)if(s.startsWith("  "))if(s=s.trim(),s.startsWith("-"))s=s.replace(/^-\s*/,""),i||(i=[]),i.push(s);else{i||(i={}),s=B(s),a=x(a?.trim()??"");let f=`${r}.${s}`;i[s]=f in T?T[f](a):a}else i?(n[r]=i,i=null):n[r]="";else s=B(s.replace(/^-\s*/,"")),a=a?.trim(),a?(a=x(a),n[s]=s in T?T[s](a):a):r=s}return r&&(n[r]=i??""),n}var ge=["index","title","aspectRatio","cropPreview","hideDate","sort"];async function K(e){let{url:t,path:n}=e;try{let r=await L(t,`${n??""}/_config.yml`),i=J(r);if(i)for(let o of ge)i[o]!==void 0&&(e[o]=i[o])}catch{}}var ye={ArrowLeft:"prev",ArrowRight:"next",Escape:"quit",Home:"start",End:"end"};function Y(){window.addEventListener("keyup",e=>{let t=ye[e.code],n=t===void 0?void 0:document.querySelector(`a[href][data-key="${t}"]`)?.href;n&&window.location.assign(n)})}function xe(){let{href:e,pathname:t,hash:n}=window.location,r="";/(\?#?|\??#)$/.test(e)?r=t:/\?#.+$/.test(e)&&(r=t+n),window.history&&r&&window.history.pushState(null,"",r)}function we(){let{pathname:e,search:t,hash:n}=window.location;window.history&&n&&setTimeout(()=>{window.history.pushState(null,"",e+t)},2e3)}function ve(){R.on("render",()=>{if(!document.documentElement.classList.contains("standalone"))return;let e=document.querySelector("figure[data-name]")?.dataset.name,{href:t,searchParams:n}=new URL(window.location.href);window.history&&e&&n.get("name")!==e&&window.history.replaceState({},"",`${t}&name=${encodeURIComponent(e)}`)})}function Z(){ve(),xe(),we()}async function X(e){Z(),Y();let t=new URLSearchParams(window.location.search),n=t.get("start")?.trim(),r=t.get("k")?.trim(),i=t.get("name")?.trim(),{url:o,path:s,index:a,pageSize:f,...d}=e,m=t.get("url")||void 0,h=t.get("path")||t.get("tag")||void 0,u={url:m||o,path:m?h:h||s,index:t.get("index")?.split(",").map(k=>k.startsWith("https://")?{url:k}:{path:k})||a,sort:"-exif.date_time",pageSize:f??60,startIndex:n&&parseInt(n,10)||0,fileIndex:r?parseInt(r,10):void 0,fileName:i||void 0,mode:document.documentElement.classList.contains("standalone")?"standalone":"list",getDisplayedDate:O,getDescription:D,renderItems:H,renderNav:Q,...d};document.documentElement.setAttribute("lang",S()),document.title=c("title"),typeof u.fileIndex=="number"&&Number.isNaN(u.fileIndex)&&(u.fileIndex=void 0),await K(u),u.title&&(document.title=u.title);let[{items:p,total:l}]=await Promise.all([F(u),W(u)]);document.documentElement.classList.remove("loading"),u.items=p,u.total=l,u.renderItems?.(u),u.renderNav?.(u),R.emit("render")}X({container:"main",navContainer:"nav",url:"https://disk.yandex.ru/d/m7msMoTw8t0MvQ",path:"0",sort:"-name",dateFormat:"short",homePage:"/"});})();
